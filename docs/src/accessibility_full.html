<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Emmanouil Tranos">
<meta name="dcterms.date" content="2024-09-25">

<title>Urban analytics and city science - Accessibility in practice</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../src/apis.html">Practicals</a></li><li class="breadcrumb-item"><a href="../src/accessibility_full.html">Accessibility in practice</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Urban analytics and city science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/etranos/urban_analytics_city_science" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Content</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/description.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Unit description and aims</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/readings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Key readings</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assessment</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Lectures</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/why_cities.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cities, a very very brief introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/smart_cities.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Smart cities, urban big data, digital twins and other buzz terms</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/intro_networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Networks: an introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/network_science.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Network science, urban laws and scaling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/transport_geography.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Methods in transport geography</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/diversity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Diversity in cities</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Practicals</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/apis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">APIs and urban data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/network_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Network analysis practical: networks of cities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/street_networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Street network analysis practical: networks within cities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/network_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Network models in practice</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/sim.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spatial interaction modelling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/accessibility_full.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Accessibility in practice</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/causality.Rmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Causal design and urban policy evaluation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Unit leader</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://etranos.info/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Professor Emmanouil Tranos</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#aims-of-the-practical" id="toc-aims-of-the-practical" class="nav-link" data-scroll-target="#aims-of-the-practical">Aims of the practical</a></li>
  <li><a href="#london-example" id="toc-london-example" class="nav-link" data-scroll-target="#london-example">London example</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../src/apis.html">Practicals</a></li><li class="breadcrumb-item"><a href="../src/accessibility_full.html">Accessibility in practice</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Accessibility in practice</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Emmanouil Tranos </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 25, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>To run this pratical you need to have an RStudio project as discussed in the <a href="https://etranos.info/urban_analytics_city_science/src/network_analysis.html">previous practical</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(accessibility)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rprojroot)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(osrm)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">find_rstudio_root_file</span>()</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the project path</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">include=</span><span class="cn">TRUE</span>, <span class="at">message=</span><span class="cn">FALSE</span>, <span class="at">warning=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="aims-of-the-practical" class="level2">
<h2 class="anchored" data-anchor-id="aims-of-the-practical">Aims of the practical</h2>
<p>The aim of this practical is to calculate different accessibility indicators. For a brief overview about accessibility, please have a look at <span class="citation" data-cites="rodrigue2020geography">(<a href="#ref-rodrigue2020geography" role="doc-biblioref">Rodrigue 2020</a>)</span> (for example <a href="https://transportgeography.org/contents/methods/transportation-accessibility/">here</a> ). For in depth reviews have a look at <span class="citation" data-cites="HOLL2007286">Holl (<a href="#ref-HOLL2007286" role="doc-biblioref">2007</a>)</span>, <span class="citation" data-cites="el2022making">El-Geneidy and Levinson (<a href="#ref-el2022making" role="doc-biblioref">2022</a>)</span> and <span class="citation" data-cites="shi2020literature">Shi et al. (<a href="#ref-shi2020literature" role="doc-biblioref">2020</a>)</span> as well as at some older and well-cited papers such as <span class="citation" data-cites="geurs2004accessibility">Geurs and Van Wee (<a href="#ref-geurs2004accessibility" role="doc-biblioref">2004</a>)</span> and <span class="citation" data-cites="bruinsma1998accessibility">Bruinsma and Rietveld (<a href="#ref-bruinsma1998accessibility" role="doc-biblioref">1998</a>)</span>. The below typology of accessibility concepts is from <span class="citation" data-cites="HOLL2007286">Holl (<a href="#ref-HOLL2007286" role="doc-biblioref">2007</a>)</span>.</p>
<ol type="1">
<li><p>Network access</p>
<ul>
<li><p>distance to access the network</p></li>
<li><p>travel opportunities</p></li>
</ul></li>
<li><p>Travel cost measures</p>
<ul>
<li>network access + distance/time travelled on the network</li>
</ul></li>
<li><p>Market potential accessibility</p>
<ul>
<li><p>destinations at greater distance provide diminishing opportunities</p></li>
<li><p><span class="math inline">\(Acc_i = \sum_j\frac{W_j} {c_{ij}^a}\)</span></p></li>
</ul></li>
</ol>
<p>Among other <code>R</code> packages, the practical is based on the <code>accessibility</code> package. Some of the below materials are based on the package’s <a href="https://cran.r-project.org/web/packages/accessibility/vignettes/accessibility.html">vignette</a>.</p>
<p>Let’s start with using the toy data that comes with the <code>accessibility</code> package. As you can see below, the data comes in <code>R</code>’s native data format called <a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/readRDS"><code>.Rds</code></a> and, therefore, we use the relevant function to read it – <code>readRDS()</code>.</p>
<p>The first data object we are using is the travel time matrix between all potential origins and destinations in city of Belo Horizonte, Brazil. As you can see, the matrix is stored in a <em>long format</em> and not as an <span class="math inline">\(n*n\)</span> matrix. If you check the dimension of that object you will understand what I mean (<code>dim(travel_matrix)</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data_dir <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"extdata"</span>, <span class="at">package =</span> <span class="st">"accessibility"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>travel_matrix <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">file.path</span>(data_dir, <span class="st">"travel_matrix.rds"</span>)) </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(travel_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           from_id           to_id travel_time
            &lt;char&gt;          &lt;char&gt;       &lt;num&gt;
1: 89a88cdb57bffff 89a88cdb57bffff         5.8
2: 89a88cdb57bffff 89a88cdb597ffff        47.0
3: 89a88cdb57bffff 89a88cdb5b3ffff        48.0
4: 89a88cdb57bffff 89a88cdb5cfffff        47.0
5: 89a88cdb57bffff 89a88cd909bffff        64.0
6: 89a88cdb57bffff 89a88cd90b7ffff        59.0</code></pre>
</div>
</div>
<p>Then, we are loading the characteristics of each location. As you can see, the <code>id</code> records match with the <code>from_id</code> and <code>to_id</code> from the <code>travel_matrix</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>land_use_data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">file.path</span>(data_dir, <span class="st">"land_use_data.rds"</span>))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(land_use_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                id population  jobs schools income_per_capita income_decile
            &lt;char&gt;      &lt;int&gt; &lt;int&gt;   &lt;int&gt;             &lt;num&gt;        &lt;fctr&gt;
1: 89a881a5a2bffff        381   180       0           22369.1            10
2: 89a881a5a2fffff        269   134       0            3205.1             9
3: 89a881a5a67ffff        929   143       0           11394.0            10
4: 89a881a5a6bffff        249    61       0            3659.8             9
5: 89a881a5a6fffff        176    11       0            4905.1            10
6: 89a881a5b03ffff        681  1071       0            2200.2             8</code></pre>
</div>
</div>
<p>The first accessibility function we are using is <code>cost_to_closest()</code>. As per its name, it calculates the minimum travel cost to the closest <em>n</em> number of opportunities. In our example, as travel cost we understand the travel time between origins and destinations included in the column <code>travel_time</code> from the <code>travel_matrix</code> object. We are only interested in the closest (n=1) opportunity, which in this example is a school.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mtc <span class="ot">&lt;-</span> <span class="fu">cost_to_closest</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  travel_matrix,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  land_use_data,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">opportunity =</span> <span class="st">"schools"</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">travel_cost =</span> <span class="st">"travel_time"</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">1</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mtc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;id&gt;
                id travel_time
            &lt;char&gt;       &lt;num&gt;
1: 89a881a5a2bffff          29
2: 89a881a5a2fffff          24
3: 89a881a5a67ffff          28
4: 89a881a5a6bffff          33
5: 89a881a5a6fffff          32
6: 89a881a5b03ffff          17</code></pre>
</div>
</div>
<p>The next measure is the total number of opportunities (in other words, the cumulative opportunities) within a cut-off of the travel cost. So, the below provides the number of jobs accessible within 30 minutes of travel time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>cum_cutoff <span class="ot">&lt;-</span> <span class="fu">cumulative_cutoff</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  travel_matrix,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  land_use_data,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">opportunity =</span> <span class="st">"jobs"</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">travel_cost =</span> <span class="st">"travel_time"</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">cutoff =</span> <span class="dv">30</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cum_cutoff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                id  jobs
            &lt;char&gt; &lt;int&gt;
1: 89a881a5a2bffff 14561
2: 89a881a5a2fffff 29452
3: 89a881a5a67ffff 16647
4: 89a881a5a6bffff 10700
5: 89a881a5a6fffff  6669
6: 89a881a5b03ffff 37029</code></pre>
</div>
</div>
<p>If the above was a form of <em>active</em> accessibility – that is how many opportunities one can access from their location – the below offers a <em>passive</em> form of accessibility – that is how many individuals can be reached from each destination within a cuttof. The latter is based on <code>travel_time</code> in the below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>passive_cum_cutoff <span class="ot">&lt;-</span> <span class="fu">cumulative_cutoff</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  travel_matrix,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  land_use_data,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">opportunity =</span> <span class="st">"population"</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">travel_cost =</span> <span class="st">"travel_time"</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">cutoff =</span> <span class="dv">30</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">active =</span> <span class="cn">FALSE</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(passive_cum_cutoff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                id population
            &lt;char&gt;      &lt;int&gt;
1: 89a881a5a2bffff      11053
2: 89a881a5a2fffff      31903
3: 89a881a5a67ffff      12488
4: 89a881a5a6bffff      14474
5: 89a881a5a6fffff      15053
6: 89a881a5b03ffff      69582</code></pre>
</div>
</div>
<p>Last, but not least we can calculate the gravity-based accessibility indicators, or, in other words, potential accessibility indicators. This is the same measure as the example we discussed during the <a href="https://etranos.info/urban_analytics_city_science/src/transport_geography.html#/spatial-interactions-and-the-gravity-model-2" target="_blank">class</a>. The intuition is that the furthest away each opportunity is, the less important it becomes. So, the accessibility of a location <span class="math inline">\(i\)</span> is equal to the sum of all opportunities available divided – in other words discounted – by the distance or the cost to reach them. The <code>negative_exp</code> function can take different decay functions (see <a href="https://cran.r-project.org/web/packages/accessibility/vignettes/decay_functions.html">here</a>). We know from previous studies that the exponential function represents better shorter interactions (e.g.&nbsp;within cities) while the power function works better for longer distance interactions (e.g.&nbsp;migrations flows) <span class="citation" data-cites="fotheringham1989spatial">Oshan (<a href="#ref-oshan2021spatial" role="doc-biblioref">2021</a>)</span>.</p>
<p><span class="math inline">\(Acc_{i} = \sum_j \frac{W_j}{d_{ij}^2}\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>negative_exp <span class="ot">&lt;-</span> <span class="fu">gravity</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  travel_matrix,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  land_use_data,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">opportunity =</span> <span class="st">"schools"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">travel_cost =</span> <span class="st">"travel_time"</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">decay_function =</span> <span class="fu">decay_exponential</span>(<span class="at">decay_value =</span> <span class="fl">0.2</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(negative_exp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                id    schools
            &lt;char&gt;      &lt;num&gt;
1: 89a88cdb57bffff 0.03041853
2: 89a88cdb597ffff 1.15549493
3: 89a88cdb5b3ffff 0.56519126
4: 89a88cdb5cfffff 0.19852152
5: 89a88cd909bffff 0.41378042
6: 89a88cd90b7ffff 0.95737555</code></pre>
</div>
</div>
<p>And now we can plot these metrics. The <code>grid</code> object is a toy spatial dataset of the places we calculate the above accessibility indicators. We first load these spatial data, merge them with the acessibility indicator we want to plot and then we plot these data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"extdata/grid_bho.rds"</span>, <span class="at">package =</span> <span class="st">"accessibility"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(grid)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>spatial_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(grid, cum_cutoff, <span class="at">by =</span> <span class="st">"id"</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> spatial_data, <span class="fu">aes</span>(<span class="at">fill =</span> jobs), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Job accessibility by transit in under 30 min."</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Accessible jobs"</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="accessibility_full_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="london-example" class="level2">
<h2 class="anchored" data-anchor-id="london-example">London example</h2>
<p>All the above were based on the data that came together with the <code>accessibility</code> package. Let’s repeat this exercise using some real world data from <a href="https://data.london.gov.uk/dataset/jobs-and-job-density-borough">data.london.gov.uk</a>. Jobs and population per Local Authority represent the opportunities.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>jobs <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://data.london.gov.uk/download/jobs-and-job-density-borough/79e85749-e38d-4bb6-8327-c60c6be27222/Jobs_and_Job_Density.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(year == 2020) %&gt;%  # I am only using 2020 data. Remove this line </span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                           # to see what will happen to the data.</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Code, Area, <span class="st">'2020'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">number_of_jobs =</span> <span class="st">'2020'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Code)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 49
Columns: 3
$ Code           &lt;chr&gt; "E09000001", "E09000002", "E09000003", "E09000004", "E0…
$ Area           &lt;chr&gt; "City of London", "Barking and Dagenham", "Barnet", "Be…
$ number_of_jobs &lt;dbl&gt; 630000, 71000, 163000, 85000, 149000, 129000, 391000, 1…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>pop <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://data.london.gov.uk/download/land-area-and-population-density-ward-and-borough/77e9257d-ad9d-47aa-aeed-59a00741f301/housing-density-borough.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span> <span class="co"># This is a projection, but it will work for now</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 36
Columns: 10
$ Code                            &lt;chr&gt; "E09000001", "E09000002", "E09000003",…
$ Name                            &lt;chr&gt; "City of London", "Barking and Dagenha…
$ Year                            &lt;dbl&gt; 2020, 2020, 2020, 2020, 2020, 2020, 20…
$ Source                          &lt;chr&gt; "GLA Population Projections", "GLA Pop…
$ Population                      &lt;dbl&gt; 8046, 218367, 407148, 254970, 343853, …
$ `Inland_Area _Hectares`         &lt;dbl&gt; 290.4, 3610.8, 8674.8, 6058.1, 4323.3,…
$ Total_Area_Hectares             &lt;dbl&gt; 314.9, 3779.9, 8674.8, 6428.6, 4323.3,…
$ Population_per_hectare          &lt;dbl&gt; 27.7, 60.5, 46.9, 42.1, 79.5, 22.4, 11…
$ Square_Kilometres               &lt;dbl&gt; 2.9, 36.1, 86.7, 60.6, 43.2, 150.1, 21…
$ Population_per_square_kilometre &lt;dbl&gt; 2770.7, 6047.6, 4693.4, 4208.8, 7953.6…</code></pre>
</div>
</div>
<p>Jobs and pop include observations for spatial units other than London’s 33 Local Authorities. Explore <code>pop</code> and <code>jobs</code> to see that. Therefore, we use the <code>inner_join()</code> function to join them. See <a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">here</a> how it works. You should be able to understand the different functions to join data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(jobs, pop, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Code"</span> <span class="ot">=</span> <span class="st">"Code"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Area <span class="sc">!=</span> <span class="st">"London"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">id =</span> Code) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To produce a nicer looking table I am using here the <code>kableExtra</code> package. It just adds some nice styling for <code>html</code> outputs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">kbl</span>() <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> F) <span class="sc">%&gt;%</span>   <span class="co">#Nice(r) table</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"900px"</span>, <span class="at">height =</span> <span class="st">"400px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:400px; overflow-x: scroll; width:900px; ">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">id</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Area</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">number_of_jobs</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Name</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Year</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">Source</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Population</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Inland_Area _Hectares</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Total_Area_Hectares</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Population_per_hectare</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Square_Kilometres</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">Population_per_square_kilometre</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">E09000001</td>
<td style="text-align: left;">City of London</td>
<td style="text-align: right;">630000</td>
<td style="text-align: left;">City of London</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">8046</td>
<td style="text-align: right;">290.4</td>
<td style="text-align: right;">314.9</td>
<td style="text-align: right;">27.7</td>
<td style="text-align: right;">2.9</td>
<td style="text-align: right;">2770.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">E09000002</td>
<td style="text-align: left;">Barking and Dagenham</td>
<td style="text-align: right;">71000</td>
<td style="text-align: left;">Barking and Dagenham</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">218367</td>
<td style="text-align: right;">3610.8</td>
<td style="text-align: right;">3779.9</td>
<td style="text-align: right;">60.5</td>
<td style="text-align: right;">36.1</td>
<td style="text-align: right;">6047.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">E09000003</td>
<td style="text-align: left;">Barnet</td>
<td style="text-align: right;">163000</td>
<td style="text-align: left;">Barnet</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">407148</td>
<td style="text-align: right;">8674.8</td>
<td style="text-align: right;">8674.8</td>
<td style="text-align: right;">46.9</td>
<td style="text-align: right;">86.7</td>
<td style="text-align: right;">4693.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">E09000004</td>
<td style="text-align: left;">Bexley</td>
<td style="text-align: right;">85000</td>
<td style="text-align: left;">Bexley</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">254970</td>
<td style="text-align: right;">6058.1</td>
<td style="text-align: right;">6428.6</td>
<td style="text-align: right;">42.1</td>
<td style="text-align: right;">60.6</td>
<td style="text-align: right;">4208.8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">E09000005</td>
<td style="text-align: left;">Brent</td>
<td style="text-align: right;">149000</td>
<td style="text-align: left;">Brent</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">343853</td>
<td style="text-align: right;">4323.3</td>
<td style="text-align: right;">4323.3</td>
<td style="text-align: right;">79.5</td>
<td style="text-align: right;">43.2</td>
<td style="text-align: right;">7953.6</td>
</tr>
<tr class="even">
<td style="text-align: left;">E09000006</td>
<td style="text-align: left;">Bromley</td>
<td style="text-align: right;">129000</td>
<td style="text-align: left;">Bromley</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">336395</td>
<td style="text-align: right;">15013.5</td>
<td style="text-align: right;">15013.5</td>
<td style="text-align: right;">22.4</td>
<td style="text-align: right;">150.1</td>
<td style="text-align: right;">2240.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">E09000007</td>
<td style="text-align: left;">Camden</td>
<td style="text-align: right;">391000</td>
<td style="text-align: left;">Camden</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">257384</td>
<td style="text-align: right;">2178.9</td>
<td style="text-align: right;">2178.9</td>
<td style="text-align: right;">118.1</td>
<td style="text-align: right;">21.8</td>
<td style="text-align: right;">11812.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">E09000008</td>
<td style="text-align: left;">Croydon</td>
<td style="text-align: right;">144000</td>
<td style="text-align: left;">Croydon</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">400272</td>
<td style="text-align: right;">8650.4</td>
<td style="text-align: right;">8650.4</td>
<td style="text-align: right;">46.3</td>
<td style="text-align: right;">86.5</td>
<td style="text-align: right;">4627.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">E09000009</td>
<td style="text-align: left;">Ealing</td>
<td style="text-align: right;">160000</td>
<td style="text-align: left;">Ealing</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">361833</td>
<td style="text-align: right;">5554.4</td>
<td style="text-align: right;">5554.4</td>
<td style="text-align: right;">65.1</td>
<td style="text-align: right;">55.5</td>
<td style="text-align: right;">6514.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">E09000010</td>
<td style="text-align: left;">Enfield</td>
<td style="text-align: right;">126000</td>
<td style="text-align: left;">Enfield</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">342993</td>
<td style="text-align: right;">8083.2</td>
<td style="text-align: right;">8220.1</td>
<td style="text-align: right;">42.4</td>
<td style="text-align: right;">80.8</td>
<td style="text-align: right;">4243.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">E09000011</td>
<td style="text-align: left;">Greenwich</td>
<td style="text-align: right;">102000</td>
<td style="text-align: left;">Greenwich</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">292466</td>
<td style="text-align: right;">4733.4</td>
<td style="text-align: right;">5043.9</td>
<td style="text-align: right;">61.8</td>
<td style="text-align: right;">47.3</td>
<td style="text-align: right;">6178.8</td>
</tr>
<tr class="even">
<td style="text-align: left;">E09000012</td>
<td style="text-align: left;">Hackney</td>
<td style="text-align: right;">152000</td>
<td style="text-align: left;">Hackney</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">289488</td>
<td style="text-align: right;">1904.9</td>
<td style="text-align: right;">1904.9</td>
<td style="text-align: right;">152.0</td>
<td style="text-align: right;">19.0</td>
<td style="text-align: right;">15197.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">E09000013</td>
<td style="text-align: left;">Hammersmith and Fulham</td>
<td style="text-align: right;">165000</td>
<td style="text-align: left;">Hammersmith and Fulham</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">190721</td>
<td style="text-align: right;">1639.7</td>
<td style="text-align: right;">1715.4</td>
<td style="text-align: right;">116.3</td>
<td style="text-align: right;">16.4</td>
<td style="text-align: right;">11631.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">E09000014</td>
<td style="text-align: left;">Haringey</td>
<td style="text-align: right;">94000</td>
<td style="text-align: left;">Haringey</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">288913</td>
<td style="text-align: right;">2959.8</td>
<td style="text-align: right;">2959.8</td>
<td style="text-align: right;">97.6</td>
<td style="text-align: right;">29.6</td>
<td style="text-align: right;">9761.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">E09000015</td>
<td style="text-align: left;">Harrow</td>
<td style="text-align: right;">90000</td>
<td style="text-align: left;">Harrow</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">261348</td>
<td style="text-align: right;">5046.3</td>
<td style="text-align: right;">5046.3</td>
<td style="text-align: right;">51.8</td>
<td style="text-align: right;">50.5</td>
<td style="text-align: right;">5179.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">E09000016</td>
<td style="text-align: left;">Havering</td>
<td style="text-align: right;">95000</td>
<td style="text-align: left;">Havering</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">261830</td>
<td style="text-align: right;">11235.0</td>
<td style="text-align: right;">11445.7</td>
<td style="text-align: right;">23.3</td>
<td style="text-align: right;">112.3</td>
<td style="text-align: right;">2330.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">E09000017</td>
<td style="text-align: left;">Hillingdon</td>
<td style="text-align: right;">206000</td>
<td style="text-align: left;">Hillingdon</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">316253</td>
<td style="text-align: right;">11570.1</td>
<td style="text-align: right;">11570.1</td>
<td style="text-align: right;">27.3</td>
<td style="text-align: right;">115.7</td>
<td style="text-align: right;">2733.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">E09000018</td>
<td style="text-align: left;">Hounslow</td>
<td style="text-align: right;">169000</td>
<td style="text-align: left;">Hounslow</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">284358</td>
<td style="text-align: right;">5597.8</td>
<td style="text-align: right;">5658.5</td>
<td style="text-align: right;">50.8</td>
<td style="text-align: right;">56.0</td>
<td style="text-align: right;">5079.8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">E09000019</td>
<td style="text-align: left;">Islington</td>
<td style="text-align: right;">247000</td>
<td style="text-align: left;">Islington</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">242827</td>
<td style="text-align: right;">1485.7</td>
<td style="text-align: right;">1485.7</td>
<td style="text-align: right;">163.4</td>
<td style="text-align: right;">14.9</td>
<td style="text-align: right;">16344.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">E09000020</td>
<td style="text-align: left;">Kensington and Chelsea</td>
<td style="text-align: right;">149000</td>
<td style="text-align: left;">Kensington and Chelsea</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">160794</td>
<td style="text-align: right;">1212.4</td>
<td style="text-align: right;">1238.4</td>
<td style="text-align: right;">132.6</td>
<td style="text-align: right;">12.1</td>
<td style="text-align: right;">13262.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">E09000021</td>
<td style="text-align: left;">Kingston upon Thames</td>
<td style="text-align: right;">89000</td>
<td style="text-align: left;">Kingston upon Thames</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">182728</td>
<td style="text-align: right;">3726.1</td>
<td style="text-align: right;">3726.1</td>
<td style="text-align: right;">49.0</td>
<td style="text-align: right;">37.3</td>
<td style="text-align: right;">4904.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">E09000022</td>
<td style="text-align: left;">Lambeth</td>
<td style="text-align: right;">175000</td>
<td style="text-align: left;">Lambeth</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">340324</td>
<td style="text-align: right;">2681.0</td>
<td style="text-align: right;">2724.9</td>
<td style="text-align: right;">126.9</td>
<td style="text-align: right;">26.8</td>
<td style="text-align: right;">12693.9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">E09000023</td>
<td style="text-align: left;">Lewisham</td>
<td style="text-align: right;">84000</td>
<td style="text-align: left;">Lewisham</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">317465</td>
<td style="text-align: right;">3514.9</td>
<td style="text-align: right;">3532.0</td>
<td style="text-align: right;">90.3</td>
<td style="text-align: right;">35.1</td>
<td style="text-align: right;">9031.9</td>
</tr>
<tr class="even">
<td style="text-align: left;">E09000024</td>
<td style="text-align: left;">Merton</td>
<td style="text-align: right;">97000</td>
<td style="text-align: left;">Merton</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">212658</td>
<td style="text-align: right;">3762.5</td>
<td style="text-align: right;">3762.5</td>
<td style="text-align: right;">56.5</td>
<td style="text-align: right;">37.6</td>
<td style="text-align: right;">5652.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">E09000025</td>
<td style="text-align: left;">Newham</td>
<td style="text-align: right;">136000</td>
<td style="text-align: left;">Newham</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">363552</td>
<td style="text-align: right;">3619.8</td>
<td style="text-align: right;">3857.4</td>
<td style="text-align: right;">100.4</td>
<td style="text-align: right;">36.2</td>
<td style="text-align: right;">10043.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">E09000026</td>
<td style="text-align: left;">Redbridge</td>
<td style="text-align: right;">90000</td>
<td style="text-align: left;">Redbridge</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">312264</td>
<td style="text-align: right;">5641.9</td>
<td style="text-align: right;">5644.2</td>
<td style="text-align: right;">55.3</td>
<td style="text-align: right;">56.4</td>
<td style="text-align: right;">5534.7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">E09000027</td>
<td style="text-align: left;">Richmond upon Thames</td>
<td style="text-align: right;">100000</td>
<td style="text-align: left;">Richmond upon Thames</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">201713</td>
<td style="text-align: right;">5740.7</td>
<td style="text-align: right;">5876.1</td>
<td style="text-align: right;">35.1</td>
<td style="text-align: right;">57.4</td>
<td style="text-align: right;">3513.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">E09000028</td>
<td style="text-align: left;">Southwark</td>
<td style="text-align: right;">310000</td>
<td style="text-align: left;">Southwark</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">330290</td>
<td style="text-align: right;">2886.2</td>
<td style="text-align: right;">2991.3</td>
<td style="text-align: right;">114.4</td>
<td style="text-align: right;">28.9</td>
<td style="text-align: right;">11443.8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">E09000029</td>
<td style="text-align: left;">Sutton</td>
<td style="text-align: right;">82000</td>
<td style="text-align: left;">Sutton</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">211297</td>
<td style="text-align: right;">4384.7</td>
<td style="text-align: right;">4384.7</td>
<td style="text-align: right;">48.2</td>
<td style="text-align: right;">43.8</td>
<td style="text-align: right;">4819.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">E09000030</td>
<td style="text-align: left;">Tower Hamlets</td>
<td style="text-align: right;">321000</td>
<td style="text-align: left;">Tower Hamlets</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">328043</td>
<td style="text-align: right;">1978.1</td>
<td style="text-align: right;">2157.9</td>
<td style="text-align: right;">165.8</td>
<td style="text-align: right;">19.8</td>
<td style="text-align: right;">16583.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">E09000031</td>
<td style="text-align: left;">Waltham Forest</td>
<td style="text-align: right;">85000</td>
<td style="text-align: left;">Waltham Forest</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">290024</td>
<td style="text-align: right;">3880.8</td>
<td style="text-align: right;">3880.8</td>
<td style="text-align: right;">74.7</td>
<td style="text-align: right;">38.8</td>
<td style="text-align: right;">7473.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">E09000032</td>
<td style="text-align: left;">Wandsworth</td>
<td style="text-align: right;">147000</td>
<td style="text-align: left;">Wandsworth</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">332731</td>
<td style="text-align: right;">3426.4</td>
<td style="text-align: right;">3522.0</td>
<td style="text-align: right;">97.1</td>
<td style="text-align: right;">34.3</td>
<td style="text-align: right;">9710.8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">E09000033</td>
<td style="text-align: left;">Westminster</td>
<td style="text-align: right;">747000</td>
<td style="text-align: left;">Westminster</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">GLA Population Projections</td>
<td style="text-align: right;">259981</td>
<td style="text-align: right;">2148.7</td>
<td style="text-align: right;">2203.0</td>
<td style="text-align: right;">121.0</td>
<td style="text-align: right;">21.5</td>
<td style="text-align: right;">12099.5</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p>Next, we are bringing the spatial data – that is the polygons – for London’s Local Authorities. We start by downloading all the polygons for all Local Authorities in the country. Please go to this <a href="https://geoportal.statistics.gov.uk/datasets/1119a90ec5f343678f044374392e6bda_0/explore">webpage</a>, download the <code>geojson</code> file and save it to the appropriate <code>data</code> folder within your project directory.</p>
<p>However, we don’t need all the Local Authorities, but instead we only need to ones within London. Therefore we use the <code>filter</code> option to select only the Local Authorities which are included within – this is the <code>%in%</code> operator – the <code>df$id</code> column. Finally, we create a new object which only includes the centroids of these polygons. Why are we doing this? Because we need to calculate distances and accessibility metrics for specific points and we will use these points as representative for each Local Authority.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Do you see any problems with this approach?</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>path.shape <span class="ot">&lt;-</span> <span class="fu">paste0</span>(path, <span class="st">"/data/Local_Authority_Districts_(May_2021)_UK_BFE.geojson"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>london <span class="ot">&lt;-</span> <span class="fu">st_read</span>(path.shape) <span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(LAD21CD <span class="sc">%in%</span> (df<span class="sc">$</span>id))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `LAD_MAY_2021_UK_BFE_V2' from data source 
  `/Users/nw19521/Library/CloudStorage/OneDrive-UniversityofBristol/Bristol/teaching/urban_analytics_city_science/data/Local_Authority_Districts_(May_2021)_UK_BFE.geojson' 
  using driver `GeoJSON'
Simple feature collection with 374 features and 9 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -8.649996 ymin: 49.86463 xmax: 1.768937 ymax: 60.86087
Geodetic CRS:  WGS 84</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>london.centres <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(london)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we need to actually calculate the distance matrix. We are going to use a real world road network to perform what is known as <em>routing</em>. There is a great discussion about routing and before you move forward I would encourage you to read the relevant section from <span class="citation" data-cites="lovelace2019geocomputation">Lovelace, Nowosad, and Muenchow (<a href="#ref-lovelace2019geocomputation" role="doc-biblioref">2019</a>)</span>, which can be found <a href="https://geocompr.robinlovelace.net/transport.html#routes">here</a>.</p>
<p>We are using the <code>osmr</code> package which can do routing for us. The details of the <code>osrm</code> package can be founf <a href="https://github.com/riatelab/osrm">here</a>.</p>
<p>The below code creates a distance table between all the <code>london.centres</code>. We are interested in distance measured as time – i.e.&nbsp;duration – by car. The <code>osrm</code> package offers other options too.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>dist <span class="ot">&lt;-</span> <span class="fu">osrmTable</span>(<span class="at">loc =</span> london.centres, </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">measure =</span> <span class="st">"duration"</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">osrm.profile =</span> <span class="st">"car"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The output of the above is a list with an <span class="math inline">\(n*n\)</span> distance matrix, and a dataframe with the longitude and latitude of the origins and destinations. We are mostly interested in the former, so we start the data wrangling by creating a <code>help</code> dataframe with these distances, or in other words, durations. We then add row and column names using the <code>london.centres</code> names. We can just do that because the matrix follows the same order as the intimal spatial data of Local Authorities. I always like to throw in a <code>dim</code> function just to keep an eye on the dimensions of the objects I create. Indeed, the <code>dist</code> object is a <span class="math inline">\(33*33\)</span> matrix as it should have been.</p>
<p>Then, we need to convert the <span class="math inline">\(n*n\)</span> matrix to a long format. If you remember, we used to call this format an <a href="https://etranos.info/urban_analytics_city_science/src/intro_networks.html#/directed-weighted-networks-1">edge list</a>. There are different way to do this. We can use the ready-made function <code>odmatrix_to_od()</code> from the <code>od</code> package. To see how it works, make sure that the <code>od</code> package is installed and then type the following: <code>od::odmatrix_to_od</code>. This will reveal how the <code>odmatrix_to_od()</code> function works under the hood. As you can see the magic happens by using the following R-base function: <code>as.data.frame(as.table(odmatrix))</code>. Therefore, I just used the below R-base function. You can, of course, use directly the <code>odmatrix_to_od()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>help <span class="ot">&lt;-</span> dist<span class="sc">$</span>durations </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(help) <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(london.centres<span class="sc">$</span>LAD21CD)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(help) <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(london.centres<span class="sc">$</span>LAD21CD)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(dist<span class="sc">$</span>durations)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 33 33</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>dist.df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">as.table</span>(help)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">from_id =</span> Var1,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">to_id =</span> Var2,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">travel_time =</span> Freq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As before, we calculate the cumulative opportunities for London’s Local Authorities (the centroids to be more accurate) within a cut-off of 20 minutes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>mtc <span class="ot">&lt;-</span> <span class="fu">cumulative_cutoff</span>(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  dist.df,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  df,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">opportunity =</span> <span class="st">"number_of_jobs"</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">travel_cost =</span> <span class="st">"travel_time"</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">cutoff =</span> <span class="dv">20</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mtc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         id number_of_jobs
1 E09000001        2973000
2 E09000002         392000
3 E09000003         496000
4 E09000004         187000
5 E09000005         562000
6 E09000006         357000</code></pre>
</div>
</div>
<p>And finally, we plot our accessibility map.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>london <span class="ot">&lt;-</span> <span class="fu">merge</span>(london, mtc, <span class="at">by.x =</span> <span class="st">"LAD21CD"</span>, <span class="at">by.y =</span> <span class="st">"id"</span> )</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> london, <span class="fu">aes</span>(<span class="at">fill =</span> number_of_jobs), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Job accessibility by driving in under 20 min"</span>,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Accessible jobs"</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="accessibility_full_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Can you calculate and plot other accessibility metrics for London?</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>What do we miss by focusing on London’ accessibility?</p>
</div>
</div>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-bruinsma1998accessibility" class="csl-entry" role="listitem">
Bruinsma, Frank, and Pieter Rietveld. 1998. <span>“The Accessibility of European Cities: Theoretical Framework and Comparison of Approaches.”</span> <em>Environment and Planning A</em> 30 (3): 499–521.
</div>
<div id="ref-el2022making" class="csl-entry" role="listitem">
El-Geneidy, Ahmed, and David Levinson. 2022. <span>“Making Accessibility Work in Practice.”</span> <em>Transport Reviews</em> 42 (2): 129–33.
</div>
<div id="ref-fotheringham1989spatial" class="csl-entry" role="listitem">
Fotheringham, A Stewart, and Morton E O’Kelly. 1989. <em>Spatial Interaction Models: Formulations and Applications</em>. Vol. 1. Kluwer Academic Publishers Dordrecht.
</div>
<div id="ref-geurs2004accessibility" class="csl-entry" role="listitem">
Geurs, Karst T, and Bert Van Wee. 2004. <span>“Accessibility Evaluation of Land-Use and Transport Strategies: Review and Research Directions.”</span> <em>Journal of Transport Geography</em> 12 (2): 127–40.
</div>
<div id="ref-HOLL2007286" class="csl-entry" role="listitem">
Holl, Adelheid. 2007. <span>“Twenty Years of Accessibility Improvements. The Case of the Spanish Motorway Building Programme.”</span> <em>Journal of Transport Geography</em> 15 (4): 286–97. https://doi.org/<a href="https://doi.org/10.1016/j.jtrangeo.2006.09.003">https://doi.org/10.1016/j.jtrangeo.2006.09.003</a>.
</div>
<div id="ref-lovelace2019geocomputation" class="csl-entry" role="listitem">
Lovelace, Robin, Jakub Nowosad, and Jannes Muenchow. 2019. <em>Geocomputation with r</em>. Chapman; Hall/CRC.
</div>
<div id="ref-oshan2021spatial" class="csl-entry" role="listitem">
Oshan, Taylor M. 2021. <span>“The Spatial Structure Debate in Spatial Interaction Modeling: 50 Years On.”</span> <em>Progress in Human Geography</em> 45 (5): 925–50.
</div>
<div id="ref-rodrigue2020geography" class="csl-entry" role="listitem">
Rodrigue, Jean-Paul. 2020. <em>The Geography of Transport Systems</em>. Routledge. <a href="https://transportgeography.org/">https://transportgeography.org/</a>.
</div>
<div id="ref-shi2020literature" class="csl-entry" role="listitem">
Shi, Yuji, Simon Blainey, Chao Sun, and Peng Jing. 2020. <span>“A Literature Review on Accessibility Using Bibliometric Analysis Techniques.”</span> <em>Journal of Transport Geography</em> 87: 102810.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>