<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.37">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Emmanouil Tranos">
<meta name="dcterms.date" content="2022-11-11">

<title>Urban analytics and city science - Accessibility in practice</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Accessibility in practice</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Urban analytics and city science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/etranos/urban_analytics_city_science" title="" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Content</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/description.html" class="sidebar-item-text sidebar-link">Unit description and aims</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/syllabus.html" class="sidebar-item-text sidebar-link">Syllabus</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/readings.html" class="sidebar-item-text sidebar-link">Key readings</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/project.html" class="sidebar-item-text sidebar-link">Assessment</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Lectures</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/why_cities.html" class="sidebar-item-text sidebar-link">Cities, a very very brief introduction</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/smart_cities.html" class="sidebar-item-text sidebar-link">Smart cities, urban big data, digital twins and other buzz terms</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/intro_networks.html" class="sidebar-item-text sidebar-link">Networks: an introduction</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/network_science.html" class="sidebar-item-text sidebar-link">Network science, urban laws and scaling</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/transport_geography.html" class="sidebar-item-text sidebar-link">Methods in transport geography</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/diversity.html" class="sidebar-item-text sidebar-link">Diversity in cities</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Practicals</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/apis.html" class="sidebar-item-text sidebar-link">APIs and urban data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/network_analysis.html" class="sidebar-item-text sidebar-link">Network analysis practical: networks of cities</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/street_networks.html" class="sidebar-item-text sidebar-link">Street network analysis practical: networks within cities</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/network_models.html" class="sidebar-item-text sidebar-link">Network models in practice</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/accessibility_full.html" class="sidebar-item-text sidebar-link active">Accessibility in practice</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/sim.html" class="sidebar-item-text sidebar-link">Spatial interaction modelling</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">Unit leader</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/author.html" class="sidebar-item-text sidebar-link">Professor Emmanouil Tranos</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#aims-of-the-practical" id="toc-aims-of-the-practical" class="nav-link" data-scroll-target="#aims-of-the-practical">Aims of the practical</a></li>
  <li><a href="#london-example" id="toc-london-example" class="nav-link" data-scroll-target="#london-example">London example</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Accessibility in practice</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Emmanouil Tranos </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 11, 2022</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>To run this pratical you need to have an RStudio project as discussed in the <a href="https://etranos.info/urban_analytics_city_science/src/network_analysis.html">previous practical</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(accessibility)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#library(data.table)</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rprojroot)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(osrm)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">find_rstudio_root_file</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="aims-of-the-practical" class="level2">
<h2 class="anchored" data-anchor-id="aims-of-the-practical">Aims of the practical</h2>
<p>The aim of this practical is to calculate different accessibility indicators. For a brief overview about accessibility, please have a look at <span class="citation" data-cites="rodrigue2020geography">(<a href="#ref-rodrigue2020geography" role="doc-biblioref">Rodrigue 2020</a>)</span> (for example <a href="https://transportgeography.org/contents/methods/transportation-accessibility/">here</a> and). For a review have a look <span class="citation" data-cites="HOLL2007286">Holl (<a href="#ref-HOLL2007286" role="doc-biblioref">2007</a>)</span>, <span class="citation" data-cites="el2022making">El-Geneidy and Levinson (<a href="#ref-el2022making" role="doc-biblioref">2022</a>)</span> and <span class="citation" data-cites="shi2020literature">Shi et al. (<a href="#ref-shi2020literature" role="doc-biblioref">2020</a>)</span> as well as some older and well cited papers such as <span class="citation" data-cites="geurs2004accessibility">Geurs and Van Wee (<a href="#ref-geurs2004accessibility" role="doc-biblioref">2004</a>)</span> and <span class="citation" data-cites="bruinsma1998accessibility">Bruinsma and Rietveld (<a href="#ref-bruinsma1998accessibility" role="doc-biblioref">1998</a>)</span>. The below typology of accessibility concepts is from <span class="citation" data-cites="HOLL2007286">Holl (<a href="#ref-HOLL2007286" role="doc-biblioref">2007</a>)</span>.</p>
<ol type="1">
<li><p>Network access</p>
<ul>
<li><p>distance to access the network</p></li>
<li><p>travel opportunities</p></li>
</ul></li>
<li><p>Travel cost measures</p>
<ul>
<li>network access + distance/time travelled on the network</li>
</ul></li>
<li><p>Market potential accessibility</p>
<ul>
<li><p>destinations at greater distance provide diminishing opportunities</p></li>
<li><p><span class="math inline">\(Acc_i = \sum_j\frac{W_j} {c_{ij}^a}\)</span></p></li>
</ul></li>
</ol>
<p>Among other <code>R</code> packages, the practical is based on the <code>accessibility</code> package. Some of the below materials are based on the package’s <a href="https://cran.r-project.org/web/packages/accessibility/vignettes/accessibility.html">vignette</a>.</p>
<p>Let’s start with using the toy data that comes with the <code>accessibility</code> package. As you can see below, the data comes in <code>R</code>’s native data format called <a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/readRDS"><code>Rds</code></a> and, therefore, we use the relevant function to read it – <code>readRDS()</code>.</p>
<p>The first data object we are using is the travel time matrix between all potential origins and destinations in city of Belo Horizonte, Brazil. As you can see, the matrix is stored in a <em>long format</em> and not as an <span class="math inline">\(n*n\)</span> matrix. If you check the dimension of that object you will understand what I mean (<code>dim(travel_matrix)</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data_dir <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"extdata"</span>, <span class="at">package =</span> <span class="st">"accessibility"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>travel_matrix <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">file.path</span>(data_dir, <span class="st">"travel_matrix.rds"</span>)) </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(travel_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           from_id           to_id travel_time
1: 89a88cdb57bffff 89a88cdb57bffff         5.8
2: 89a88cdb57bffff 89a88cdb597ffff        47.0
3: 89a88cdb57bffff 89a88cdb5b3ffff        48.0
4: 89a88cdb57bffff 89a88cdb5cfffff        47.0
5: 89a88cdb57bffff 89a88cd909bffff        64.0
6: 89a88cdb57bffff 89a88cd90b7ffff        59.0</code></pre>
</div>
</div>
<p>Then, we are loading the characteristics of each location. As you can see, the <code>id</code> records match with the <code>from_id</code> and <code>to_id</code> from the <code>travel_matrix</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>land_use_data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">file.path</span>(data_dir, <span class="st">"land_use_data.rds"</span>))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(land_use_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                id population jobs schools
1: 89a88cdb57bffff        606   82       0
2: 89a88cdb597ffff        734  308       2
3: 89a88cdb5b3ffff       1670  100       0
4: 89a88cdb5cfffff       1864  109       0
5: 89a88cd909bffff         29    0       0
6: 89a88cd90b7ffff       1117  480       0</code></pre>
</div>
</div>
<p>The first accessibility function we are using is <code>cost_to_closest()</code>. As per its name, it calculates the minimum travel cost to the closest <em>n</em> number of opportunities. In our example, as travel cost we understand the travel time between origins and destinations included in the column <code>travel_time</code> from the <code>travel_matrix</code> object. We are only interested in the closest (n=1) opportunity, which in this example is a school.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mtc <span class="ot">&lt;-</span> <span class="fu">cost_to_closest</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  travel_matrix,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  land_use_data,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">opportunity =</span> <span class="st">"schools"</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">travel_cost =</span> <span class="st">"travel_time"</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">1</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mtc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                id travel_time
1: 89a881a5a2bffff          29
2: 89a881a5a2fffff          24
3: 89a881a5a67ffff          28
4: 89a881a5a6bffff          33
5: 89a881a5a6fffff          32
6: 89a881a5b03ffff          17</code></pre>
</div>
</div>
<p>The next measure is the total number of opportunities (in other words cummulative opportunities) within a cut-off of the travel cost. In other words, the below provides the nu,ber of jobs accessibile within 30 minutes of travel time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>cum_cutoff <span class="ot">&lt;-</span> <span class="fu">cumulative_cutoff</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  travel_matrix,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  land_use_data,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">opportunity =</span> <span class="st">"jobs"</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">travel_cost =</span> <span class="st">"travel_time"</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">cutoff =</span> <span class="dv">30</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cum_cutoff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                id  jobs
1: 89a88cdb57bffff 22239
2: 89a88cdb597ffff 36567
3: 89a88cdb5b3ffff 42372
4: 89a88cdb5cfffff 55571
5: 89a88cd909bffff 26774
6: 89a88cd90b7ffff 36991</code></pre>
</div>
</div>
<p>If the above was a form of <em>active</em> accessibility – that is how many opportunities one can access from their location – the below offers a <em>passive</em> form of accessibility – that is how many individuals can be reached from each destination within a cuttof. The latter is based on <code>travel_time</code> in the below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>passive_cum_cutoff <span class="ot">&lt;-</span> <span class="fu">cumulative_cutoff</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  travel_matrix,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  land_use_data,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">opportunity =</span> <span class="st">"population"</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">travel_cost =</span> <span class="st">"travel_time"</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">cutoff =</span> <span class="dv">30</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">active =</span> <span class="cn">FALSE</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(passive_cum_cutoff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                id population
1: 89a88cdb57bffff      62591
2: 89a88cdb19bffff     180316
3: 89a88cdb1d3ffff     185293
4: 89a88cdb56fffff     162202
5: 89a88cdb0afffff     243124
6: 89a88cdb50fffff     107605</code></pre>
</div>
</div>
<p>Last, but not least we can calculate the gravity based accessibility indicators, or, in other words, potential accessibility indicators. This is the same measure as the example we discussed during the class <strong>ADD LINK</strong>. The intuition is that the furthest away each opportunity is, the less important it becomes. So, the accessibility of a location <span class="math inline">\(i\)</span> is equal to the sum of all opportunities available divided – in other words discounted – by the distance or the cost to reach them. The <code>negative_exp</code> function can take different decay functions (see <a href="https://cran.r-project.org/web/packages/accessibility/vignettes/decay_functions.html">here</a>). We know from previous studies that the exponential function represents better shorter interactions (e.g.&nbsp;within cities) while the power function works better for longer distance interactions (e.g.&nbsp;migrations flows) <span class="citation" data-cites="fotheringham1989spatial">(<a href="#ref-article" role="doc-biblioref"><strong>article?</strong></a>)</span>.</p>
<p><span class="math inline">\(Acc_{i} = \sum_j \frac{W_j}{d_{ij}^2}\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>negative_exp <span class="ot">&lt;-</span> <span class="fu">gravity</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  travel_matrix,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  land_use_data,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">opportunity =</span> <span class="st">"schools"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">travel_cost =</span> <span class="st">"travel_time"</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">decay_function =</span> <span class="fu">decay_exponential</span>(<span class="at">decay_value =</span> <span class="fl">0.2</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(negative_exp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                id    schools
1: 89a88cdb57bffff 0.03041853
2: 89a88cdb597ffff 1.15549493
3: 89a88cdb5b3ffff 0.56519126
4: 89a88cdb5cfffff 0.19852152
5: 89a88cd909bffff 0.41378042
6: 89a88cd90b7ffff 0.95737555</code></pre>
</div>
</div>
<p>And now we can plot these metrics. The <code>grid</code> object is a toy spatial dataset of the places we calculate the above accessibility indicators. We first load these spatial data, merge them with the acessibility indicator we want to plot and then we plot these data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"extdata/grid_bho.rds"</span>, <span class="at">package =</span> <span class="st">"accessibility"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(grid)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>spatial_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(grid, cum_cutoff, <span class="at">by =</span> <span class="st">"id"</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> spatial_data, <span class="fu">aes</span>(<span class="at">fill =</span> jobs), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Job accessibility by transit in under 30 min."</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Accessible jobs"</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="accessibility_full_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="london-example" class="level2">
<h2 class="anchored" data-anchor-id="london-example">London example</h2>
<p>All the above were based on the data that came together with the <code>accessibility</code> package. Let’s repeat this exercise using some real world data from <a href="https://data.london.gov.uk/dataset/jobs-and-job-density-borough">data.london.gov.uk</a>. Jobs and population per local authority represent the opportunities.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>jobs <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://data.london.gov.uk/download/jobs-and-job-density-borough/79e85749-e38d-4bb6-8327-c60c6be27222/Jobs_and_Job_Density.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span>  <span class="co"># I am only using 2020 data. Remove this line </span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># to see what will happen to the data.</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 1029 Columns: 5
-- Column specification --------------------------------------------------------
Delimiter: ","
chr (2): code, area
dbl (3): year, number_of_jobs, job_density

i Use `spec()` to retrieve the full column specification for this data.
i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 49
Columns: 5
$ code           &lt;chr&gt; "E09000001", "E09000002", "E09000003", "E09000004", "E0~
$ area           &lt;chr&gt; "City of London", "Barking and Dagenham", "Barnet", "Be~
$ year           &lt;dbl&gt; 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2~
$ number_of_jobs &lt;dbl&gt; 630000, 71000, 164000, 85000, 149000, 129000, 389000, 1~
$ job_density    &lt;dbl&gt; 83.71, 0.52, 0.64, 0.54, 0.69, 0.62, 1.97, 0.58, 0.72, ~</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>pop <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://data.london.gov.uk/download/land-area-and-population-density-ward-and-borough/77e9257d-ad9d-47aa-aeed-59a00741f301/housing-density-borough.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span> <span class="co"># This is a projection, but it will work for now</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 1872 Columns: 10
-- Column specification --------------------------------------------------------
Delimiter: ","
chr (3): Code, Name, Source
dbl (7): Year, Population, Inland_Area _Hectares, Total_Area_Hectares, Popul...

i Use `spec()` to retrieve the full column specification for this data.
i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 36
Columns: 10
$ Code                            &lt;chr&gt; "E09000001", "E09000002", "E09000003",~
$ Name                            &lt;chr&gt; "City of London", "Barking and Dagenha~
$ Year                            &lt;dbl&gt; 2020, 2020, 2020, 2020, 2020, 2020, 20~
$ Source                          &lt;chr&gt; "GLA Population Projections", "GLA Pop~
$ Population                      &lt;dbl&gt; 8046, 218367, 407148, 254970, 343853, ~
$ `Inland_Area _Hectares`         &lt;dbl&gt; 290.4, 3610.8, 8674.8, 6058.1, 4323.3,~
$ Total_Area_Hectares             &lt;dbl&gt; 314.9, 3779.9, 8674.8, 6428.6, 4323.3,~
$ Population_per_hectare          &lt;dbl&gt; 27.7, 60.5, 46.9, 42.1, 79.5, 22.4, 11~
$ Square_Kilometres               &lt;dbl&gt; 2.9, 36.1, 86.7, 60.6, 43.2, 150.1, 21~
$ Population_per_square_kilometre &lt;dbl&gt; 2770.7, 6047.6, 4693.4, 4208.8, 7953.6~</code></pre>
</div>
</div>
<p>Jobs and pop include observations for spatial units other than London’s 33 local authorities. Explore <code>pop</code> and <code>jobs</code> to see that. Therefore, we use the <code>inner_join()</code> function to join them. See <a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">here</a> how it works. You shoud be able to understand the different function to join data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(jobs, pop, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"code"</span> <span class="ot">=</span> <span class="st">"Code"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(area <span class="sc">!=</span> <span class="st">"London"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">id =</span> code) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To produce a nicer looking table I am using here the <code>kableExtra</code> package. It just adds some nice styling for <code>html</code> outputs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">kbl</span>() <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()   <span class="co">#Nice(r) table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> id </th>
   <th style="text-align:left;"> area </th>
   <th style="text-align:right;"> year </th>
   <th style="text-align:right;"> number_of_jobs </th>
   <th style="text-align:right;"> job_density </th>
   <th style="text-align:left;"> Name </th>
   <th style="text-align:right;"> Year </th>
   <th style="text-align:left;"> Source </th>
   <th style="text-align:right;"> Population </th>
   <th style="text-align:right;"> Inland_Area _Hectares </th>
   <th style="text-align:right;"> Total_Area_Hectares </th>
   <th style="text-align:right;"> Population_per_hectare </th>
   <th style="text-align:right;"> Square_Kilometres </th>
   <th style="text-align:right;"> Population_per_square_kilometre </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> E09000001 </td>
   <td style="text-align:left;"> City of London </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 630000 </td>
   <td style="text-align:right;"> 83.71 </td>
   <td style="text-align:left;"> City of London </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 8046 </td>
   <td style="text-align:right;"> 290.4 </td>
   <td style="text-align:right;"> 314.9 </td>
   <td style="text-align:right;"> 27.7 </td>
   <td style="text-align:right;"> 2.9 </td>
   <td style="text-align:right;"> 2770.7 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000002 </td>
   <td style="text-align:left;"> Barking and Dagenham </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 71000 </td>
   <td style="text-align:right;"> 0.52 </td>
   <td style="text-align:left;"> Barking and Dagenham </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 218367 </td>
   <td style="text-align:right;"> 3610.8 </td>
   <td style="text-align:right;"> 3779.9 </td>
   <td style="text-align:right;"> 60.5 </td>
   <td style="text-align:right;"> 36.1 </td>
   <td style="text-align:right;"> 6047.6 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000003 </td>
   <td style="text-align:left;"> Barnet </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 164000 </td>
   <td style="text-align:right;"> 0.64 </td>
   <td style="text-align:left;"> Barnet </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 407148 </td>
   <td style="text-align:right;"> 8674.8 </td>
   <td style="text-align:right;"> 8674.8 </td>
   <td style="text-align:right;"> 46.9 </td>
   <td style="text-align:right;"> 86.7 </td>
   <td style="text-align:right;"> 4693.4 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000004 </td>
   <td style="text-align:left;"> Bexley </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 85000 </td>
   <td style="text-align:right;"> 0.54 </td>
   <td style="text-align:left;"> Bexley </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 254970 </td>
   <td style="text-align:right;"> 6058.1 </td>
   <td style="text-align:right;"> 6428.6 </td>
   <td style="text-align:right;"> 42.1 </td>
   <td style="text-align:right;"> 60.6 </td>
   <td style="text-align:right;"> 4208.8 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000005 </td>
   <td style="text-align:left;"> Brent </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 149000 </td>
   <td style="text-align:right;"> 0.69 </td>
   <td style="text-align:left;"> Brent </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 343853 </td>
   <td style="text-align:right;"> 4323.3 </td>
   <td style="text-align:right;"> 4323.3 </td>
   <td style="text-align:right;"> 79.5 </td>
   <td style="text-align:right;"> 43.2 </td>
   <td style="text-align:right;"> 7953.6 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000006 </td>
   <td style="text-align:left;"> Bromley </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 129000 </td>
   <td style="text-align:right;"> 0.62 </td>
   <td style="text-align:left;"> Bromley </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 336395 </td>
   <td style="text-align:right;"> 15013.5 </td>
   <td style="text-align:right;"> 15013.5 </td>
   <td style="text-align:right;"> 22.4 </td>
   <td style="text-align:right;"> 150.1 </td>
   <td style="text-align:right;"> 2240.6 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000007 </td>
   <td style="text-align:left;"> Camden </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 389000 </td>
   <td style="text-align:right;"> 1.97 </td>
   <td style="text-align:left;"> Camden </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 257384 </td>
   <td style="text-align:right;"> 2178.9 </td>
   <td style="text-align:right;"> 2178.9 </td>
   <td style="text-align:right;"> 118.1 </td>
   <td style="text-align:right;"> 21.8 </td>
   <td style="text-align:right;"> 11812.4 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000008 </td>
   <td style="text-align:left;"> Croydon </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 143000 </td>
   <td style="text-align:right;"> 0.58 </td>
   <td style="text-align:left;"> Croydon </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 400272 </td>
   <td style="text-align:right;"> 8650.4 </td>
   <td style="text-align:right;"> 8650.4 </td>
   <td style="text-align:right;"> 46.3 </td>
   <td style="text-align:right;"> 86.5 </td>
   <td style="text-align:right;"> 4627.2 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000009 </td>
   <td style="text-align:left;"> Ealing </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 159000 </td>
   <td style="text-align:right;"> 0.72 </td>
   <td style="text-align:left;"> Ealing </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 361833 </td>
   <td style="text-align:right;"> 5554.4 </td>
   <td style="text-align:right;"> 5554.4 </td>
   <td style="text-align:right;"> 65.1 </td>
   <td style="text-align:right;"> 55.5 </td>
   <td style="text-align:right;"> 6514.3 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000010 </td>
   <td style="text-align:left;"> Enfield </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 126000 </td>
   <td style="text-align:right;"> 0.59 </td>
   <td style="text-align:left;"> Enfield </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 342993 </td>
   <td style="text-align:right;"> 8083.2 </td>
   <td style="text-align:right;"> 8220.1 </td>
   <td style="text-align:right;"> 42.4 </td>
   <td style="text-align:right;"> 80.8 </td>
   <td style="text-align:right;"> 4243.3 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000011 </td>
   <td style="text-align:left;"> Greenwich </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 101000 </td>
   <td style="text-align:right;"> 0.52 </td>
   <td style="text-align:left;"> Greenwich </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 292466 </td>
   <td style="text-align:right;"> 4733.4 </td>
   <td style="text-align:right;"> 5043.9 </td>
   <td style="text-align:right;"> 61.8 </td>
   <td style="text-align:right;"> 47.3 </td>
   <td style="text-align:right;"> 6178.8 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000012 </td>
   <td style="text-align:left;"> Hackney </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 152000 </td>
   <td style="text-align:right;"> 0.76 </td>
   <td style="text-align:left;"> Hackney </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 289488 </td>
   <td style="text-align:right;"> 1904.9 </td>
   <td style="text-align:right;"> 1904.9 </td>
   <td style="text-align:right;"> 152.0 </td>
   <td style="text-align:right;"> 19.0 </td>
   <td style="text-align:right;"> 15197.0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000013 </td>
   <td style="text-align:left;"> Hammersmith and Fulham </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 166000 </td>
   <td style="text-align:right;"> 1.29 </td>
   <td style="text-align:left;"> Hammersmith and Fulham </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 190721 </td>
   <td style="text-align:right;"> 1639.7 </td>
   <td style="text-align:right;"> 1715.4 </td>
   <td style="text-align:right;"> 116.3 </td>
   <td style="text-align:right;"> 16.4 </td>
   <td style="text-align:right;"> 11631.1 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000014 </td>
   <td style="text-align:left;"> Haringey </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 94000 </td>
   <td style="text-align:right;"> 0.51 </td>
   <td style="text-align:left;"> Haringey </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 288913 </td>
   <td style="text-align:right;"> 2959.8 </td>
   <td style="text-align:right;"> 2959.8 </td>
   <td style="text-align:right;"> 97.6 </td>
   <td style="text-align:right;"> 29.6 </td>
   <td style="text-align:right;"> 9761.1 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000015 </td>
   <td style="text-align:left;"> Harrow </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 89000 </td>
   <td style="text-align:right;"> 0.57 </td>
   <td style="text-align:left;"> Harrow </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 261348 </td>
   <td style="text-align:right;"> 5046.3 </td>
   <td style="text-align:right;"> 5046.3 </td>
   <td style="text-align:right;"> 51.8 </td>
   <td style="text-align:right;"> 50.5 </td>
   <td style="text-align:right;"> 5179.0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000016 </td>
   <td style="text-align:left;"> Havering </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 96000 </td>
   <td style="text-align:right;"> 0.60 </td>
   <td style="text-align:left;"> Havering </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 261830 </td>
   <td style="text-align:right;"> 11235.0 </td>
   <td style="text-align:right;"> 11445.7 </td>
   <td style="text-align:right;"> 23.3 </td>
   <td style="text-align:right;"> 112.3 </td>
   <td style="text-align:right;"> 2330.5 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000017 </td>
   <td style="text-align:left;"> Hillingdon </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 206000 </td>
   <td style="text-align:right;"> 1.03 </td>
   <td style="text-align:left;"> Hillingdon </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 316253 </td>
   <td style="text-align:right;"> 11570.1 </td>
   <td style="text-align:right;"> 11570.1 </td>
   <td style="text-align:right;"> 27.3 </td>
   <td style="text-align:right;"> 115.7 </td>
   <td style="text-align:right;"> 2733.4 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000018 </td>
   <td style="text-align:left;"> Hounslow </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 169000 </td>
   <td style="text-align:right;"> 0.95 </td>
   <td style="text-align:left;"> Hounslow </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 284358 </td>
   <td style="text-align:right;"> 5597.8 </td>
   <td style="text-align:right;"> 5658.5 </td>
   <td style="text-align:right;"> 50.8 </td>
   <td style="text-align:right;"> 56.0 </td>
   <td style="text-align:right;"> 5079.8 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000019 </td>
   <td style="text-align:left;"> Islington </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 246000 </td>
   <td style="text-align:right;"> 1.32 </td>
   <td style="text-align:left;"> Islington </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 242827 </td>
   <td style="text-align:right;"> 1485.7 </td>
   <td style="text-align:right;"> 1485.7 </td>
   <td style="text-align:right;"> 163.4 </td>
   <td style="text-align:right;"> 14.9 </td>
   <td style="text-align:right;"> 16344.7 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000020 </td>
   <td style="text-align:left;"> Kensington and Chelsea </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 148000 </td>
   <td style="text-align:right;"> 1.41 </td>
   <td style="text-align:left;"> Kensington and Chelsea </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 160794 </td>
   <td style="text-align:right;"> 1212.4 </td>
   <td style="text-align:right;"> 1238.4 </td>
   <td style="text-align:right;"> 132.6 </td>
   <td style="text-align:right;"> 12.1 </td>
   <td style="text-align:right;"> 13262.4 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000021 </td>
   <td style="text-align:left;"> Kingston upon Thames </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 89000 </td>
   <td style="text-align:right;"> 0.76 </td>
   <td style="text-align:left;"> Kingston upon Thames </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 182728 </td>
   <td style="text-align:right;"> 3726.1 </td>
   <td style="text-align:right;"> 3726.1 </td>
   <td style="text-align:right;"> 49.0 </td>
   <td style="text-align:right;"> 37.3 </td>
   <td style="text-align:right;"> 4904.0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000022 </td>
   <td style="text-align:left;"> Lambeth </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 174000 </td>
   <td style="text-align:right;"> 0.73 </td>
   <td style="text-align:left;"> Lambeth </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 340324 </td>
   <td style="text-align:right;"> 2681.0 </td>
   <td style="text-align:right;"> 2724.9 </td>
   <td style="text-align:right;"> 126.9 </td>
   <td style="text-align:right;"> 26.8 </td>
   <td style="text-align:right;"> 12693.9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000023 </td>
   <td style="text-align:left;"> Lewisham </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 84000 </td>
   <td style="text-align:right;"> 0.39 </td>
   <td style="text-align:left;"> Lewisham </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 317465 </td>
   <td style="text-align:right;"> 3514.9 </td>
   <td style="text-align:right;"> 3532.0 </td>
   <td style="text-align:right;"> 90.3 </td>
   <td style="text-align:right;"> 35.1 </td>
   <td style="text-align:right;"> 9031.9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000024 </td>
   <td style="text-align:left;"> Merton </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 97000 </td>
   <td style="text-align:right;"> 0.71 </td>
   <td style="text-align:left;"> Merton </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 212658 </td>
   <td style="text-align:right;"> 3762.5 </td>
   <td style="text-align:right;"> 3762.5 </td>
   <td style="text-align:right;"> 56.5 </td>
   <td style="text-align:right;"> 37.6 </td>
   <td style="text-align:right;"> 5652.1 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000025 </td>
   <td style="text-align:left;"> Newham </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 136000 </td>
   <td style="text-align:right;"> 0.55 </td>
   <td style="text-align:left;"> Newham </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 363552 </td>
   <td style="text-align:right;"> 3619.8 </td>
   <td style="text-align:right;"> 3857.4 </td>
   <td style="text-align:right;"> 100.4 </td>
   <td style="text-align:right;"> 36.2 </td>
   <td style="text-align:right;"> 10043.3 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000026 </td>
   <td style="text-align:left;"> Redbridge </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 90000 </td>
   <td style="text-align:right;"> 0.45 </td>
   <td style="text-align:left;"> Redbridge </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 312264 </td>
   <td style="text-align:right;"> 5641.9 </td>
   <td style="text-align:right;"> 5644.2 </td>
   <td style="text-align:right;"> 55.3 </td>
   <td style="text-align:right;"> 56.4 </td>
   <td style="text-align:right;"> 5534.7 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000027 </td>
   <td style="text-align:left;"> Richmond upon Thames </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 100000 </td>
   <td style="text-align:right;"> 0.80 </td>
   <td style="text-align:left;"> Richmond upon Thames </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 201713 </td>
   <td style="text-align:right;"> 5740.7 </td>
   <td style="text-align:right;"> 5876.1 </td>
   <td style="text-align:right;"> 35.1 </td>
   <td style="text-align:right;"> 57.4 </td>
   <td style="text-align:right;"> 3513.7 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000028 </td>
   <td style="text-align:left;"> Southwark </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 310000 </td>
   <td style="text-align:right;"> 1.33 </td>
   <td style="text-align:left;"> Southwark </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 330290 </td>
   <td style="text-align:right;"> 2886.2 </td>
   <td style="text-align:right;"> 2991.3 </td>
   <td style="text-align:right;"> 114.4 </td>
   <td style="text-align:right;"> 28.9 </td>
   <td style="text-align:right;"> 11443.8 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000029 </td>
   <td style="text-align:left;"> Sutton </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 82000 </td>
   <td style="text-align:right;"> 0.63 </td>
   <td style="text-align:left;"> Sutton </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 211297 </td>
   <td style="text-align:right;"> 4384.7 </td>
   <td style="text-align:right;"> 4384.7 </td>
   <td style="text-align:right;"> 48.2 </td>
   <td style="text-align:right;"> 43.8 </td>
   <td style="text-align:right;"> 4819.0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000030 </td>
   <td style="text-align:left;"> Tower Hamlets </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 320000 </td>
   <td style="text-align:right;"> 1.32 </td>
   <td style="text-align:left;"> Tower Hamlets </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 328043 </td>
   <td style="text-align:right;"> 1978.1 </td>
   <td style="text-align:right;"> 2157.9 </td>
   <td style="text-align:right;"> 165.8 </td>
   <td style="text-align:right;"> 19.8 </td>
   <td style="text-align:right;"> 16583.5 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000031 </td>
   <td style="text-align:left;"> Waltham Forest </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 85000 </td>
   <td style="text-align:right;"> 0.46 </td>
   <td style="text-align:left;"> Waltham Forest </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 290024 </td>
   <td style="text-align:right;"> 3880.8 </td>
   <td style="text-align:right;"> 3880.8 </td>
   <td style="text-align:right;"> 74.7 </td>
   <td style="text-align:right;"> 38.8 </td>
   <td style="text-align:right;"> 7473.3 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000032 </td>
   <td style="text-align:left;"> Wandsworth </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 146000 </td>
   <td style="text-align:right;"> 0.61 </td>
   <td style="text-align:left;"> Wandsworth </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 332731 </td>
   <td style="text-align:right;"> 3426.4 </td>
   <td style="text-align:right;"> 3522.0 </td>
   <td style="text-align:right;"> 97.1 </td>
   <td style="text-align:right;"> 34.3 </td>
   <td style="text-align:right;"> 9710.8 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E09000033 </td>
   <td style="text-align:left;"> Westminster </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:right;"> 749000 </td>
   <td style="text-align:right;"> 3.93 </td>
   <td style="text-align:left;"> Westminster </td>
   <td style="text-align:right;"> 2020 </td>
   <td style="text-align:left;"> GLA Population Projections </td>
   <td style="text-align:right;"> 259981 </td>
   <td style="text-align:right;"> 2148.7 </td>
   <td style="text-align:right;"> 2203.0 </td>
   <td style="text-align:right;"> 121.0 </td>
   <td style="text-align:right;"> 21.5 </td>
   <td style="text-align:right;"> 12099.5 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>Next, we are bringing the spatial data – that is the polygons – for London’s Local Authorities. We start by downloading all the polygons for all Local Authorities in the country. Please go to this <a href="https://geoportal.statistics.gov.uk/datasets/1119a90ec5f343678f044374392e6bda_0/explore">webpage</a>, download the <code>geojson</code> file and save it to the appropriate <code>data</code> folder within your project directory.</p>
<p>However, we don;t need all the Local Authorities, but instead we only need to ones within London. Therefore we use the <code>filter</code> option to select only the Local Authorities which are included within – this is the <code>%in%</code> operator – the <code>df$id</code> column. Finally, we create a new object which only includes the centroids of these polygos? Why are we doing this? Because we need to calculate distances and accessibilities metrics for specific points and we will use these points as representative for each Local Authority.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Do you see any problems with this approach?</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>path.shape <span class="ot">&lt;-</span> <span class="fu">paste0</span>(path, <span class="st">"/data/Local_Authority_Districts_(May_2021)_UK_BFE.geojson"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Towns and Cities boundary dataset and subset to Portsmouth</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>london <span class="ot">&lt;-</span> <span class="fu">st_read</span>(path.shape) <span class="sc">%&gt;%</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(LAD21CD <span class="sc">%in%</span> (df<span class="sc">$</span>id))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `LAD_MAY_2021_UK_BFE_V2' from data source 
  `C:\Users\nw19521\OneDrive - University of Bristol\Bristol\teaching\urban_analytics_city_science\data\Local_Authority_Districts_(May_2021)_UK_BFE.geojson' 
  using driver `GeoJSON'
Simple feature collection with 374 features and 9 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -8.649996 ymin: 49.86463 xmax: 1.768937 ymax: 60.86087
Geodetic CRS:  WGS 84</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>london.centres <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(london)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in st_centroid.sf(london): st_centroid assumes attributes are constant
over geometries of x</code></pre>
</div>
</div>
<p>Now we need to actually calculate the distance matrix. We are going to use a real world road network to perform what is known as <em>routing</em>. There is a great discussion about routing and before you move forward I would encourage you to read the relevant section from <span class="citation" data-cites="lovelace2019geocomputation">Lovelace, Nowosad, and Muenchow (<a href="#ref-lovelace2019geocomputation" role="doc-biblioref">2019</a>)</span>, which can be found <a href="https://geocompr.robinlovelace.net/transport.html#routes">here</a>.</p>
<p>We are using the <code>osmr</code> package which can do routing for us. The details of the <code>osrm</code> package can be founf <a href="https://github.com/riatelab/osrm">here</a>.</p>
<p>The below code creates a distance table between all the <code>london.centres</code>. We are interested in distance measured as time – i.e.&nbsp;duration – by car. The <code>osrm</code> package offers other options too.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>dist <span class="ot">&lt;-</span> <span class="fu">osrmTable</span>(<span class="at">loc =</span> london.centres, </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">measure =</span> <span class="st">"duration"</span>,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">osrm.profile =</span> <span class="st">"car"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The output of the above is a list with an <span class="math inline">\(n*n\)</span> distance matrix, and a dataframe with the longitude and latitude of the origins and destinations. We are mostly interested in the former, so we start the data wrangling by creating a <code>help</code> dataframe with these distances, or in other words, durations. We then add row and column names using the <code>london.centres</code> names. We can just do that because the matrix follows the same order as the intital spatial data of Local Authorities. I always like to throw in a <code>dim</code> function just to keep an eye on the dimensions of the objects I create. Indeed, the <code>dist</code> object is a <span class="math inline">\(33*33\)</span> matrix as it should have been.</p>
<p>Then, I use the function <code>odmatrix_to_od()</code> form the <code>od</code> package. Why? Because we need to convert the <span class="math inline">\(n*n\)</span> matrix to a long format. If you remember, we used to call this format an <a href="https://etranos.info/urban_analytics_city_science/src/intro_networks.html#/directed-weighted-networks-1">edge list</a>.</p>
<p>And at the end</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>help <span class="ot">&lt;-</span> dist<span class="sc">$</span>durations </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(help) <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(london.centres<span class="sc">$</span>LAD21CD)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(help) <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(london.centres<span class="sc">$</span>LAD21CD)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(dist<span class="sc">$</span>durations)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 33 33</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># od::odmatrix_to_od(dist$durations)</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>dist.df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">as.table</span>(help)) <span class="sc">%&gt;%</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">from_id =</span> Var1,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">to_id =</span> Var2,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">travel_time =</span> Freq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As before, we calculate the cumulative opportunities for London’s Local Authorities (the centroids to be more accurate) within a cutoff of 20 minutes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>mtc <span class="ot">&lt;-</span> <span class="fu">cumulative_cutoff</span>(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  dist.df,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  df,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">opportunity =</span> <span class="st">"number_of_jobs"</span>,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">travel_cost =</span> <span class="st">"travel_time"</span>,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">cutoff =</span> <span class="dv">20</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mtc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         id number_of_jobs
1 E09000001        2970000
2 E09000007        2721000
3 E09000012        2142000
4 E09000019        2580000
5 E09000020        2377000
6 E09000022        1344000</code></pre>
</div>
</div>
<p>And finally, we plot our accessibility map.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>london <span class="ot">&lt;-</span> <span class="fu">merge</span>(london, mtc, <span class="at">by.x =</span> <span class="st">"LAD21CD"</span>, <span class="at">by.y =</span> <span class="st">"id"</span> )</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> london, <span class="fu">aes</span>(<span class="at">fill =</span> number_of_jobs), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Job accessibility by driving in under 20 min."</span>,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Accessible jobs"</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="accessibility_full_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Can you calculate and plot other accessibility metrics for London?</p>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>What do we miss by focusing on London’ accessibility?</p>
</div>
</div>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-bruinsma1998accessibility" class="csl-entry" role="doc-biblioentry">
Bruinsma, Frank, and Pieter Rietveld. 1998. <span>“The Accessibility of European Cities: Theoretical Framework and Comparison of Approaches.”</span> <em>Environment and Planning A</em> 30 (3): 499–521.
</div>
<div id="ref-el2022making" class="csl-entry" role="doc-biblioentry">
El-Geneidy, Ahmed, and David Levinson. 2022. <span>“Making Accessibility Work in Practice.”</span> <em>Transport Reviews</em> 42 (2): 129–33.
</div>
<div id="ref-fotheringham1989spatial" class="csl-entry" role="doc-biblioentry">
Fotheringham, A Stewart, and Morton E O’Kelly. 1989. <em>Spatial Interaction Models: Formulations and Applications</em>. Vol. 1. Kluwer Academic Publishers Dordrecht.
</div>
<div id="ref-geurs2004accessibility" class="csl-entry" role="doc-biblioentry">
Geurs, Karst T, and Bert Van Wee. 2004. <span>“Accessibility Evaluation of Land-Use and Transport Strategies: Review and Research Directions.”</span> <em>Journal of Transport Geography</em> 12 (2): 127–40.
</div>
<div id="ref-HOLL2007286" class="csl-entry" role="doc-biblioentry">
Holl, Adelheid. 2007. <span>“Twenty Years of Accessibility Improvements. The Case of the Spanish Motorway Building Programme.”</span> <em>Journal of Transport Geography</em> 15 (4): 286–97. https://doi.org/<a href="https://doi.org/10.1016/j.jtrangeo.2006.09.003">https://doi.org/10.1016/j.jtrangeo.2006.09.003</a>.
</div>
<div id="ref-lovelace2019geocomputation" class="csl-entry" role="doc-biblioentry">
Lovelace, Robin, Jakub Nowosad, and Jannes Muenchow. 2019. <em>Geocomputation with r</em>. Chapman; Hall/CRC.
</div>
<div id="ref-rodrigue2020geography" class="csl-entry" role="doc-biblioentry">
Rodrigue, Jean-Paul. 2020. <em>The Geography of Transport Systems</em>. Routledge. <a href="https://transportgeography.org/">https://transportgeography.org/</a>.
</div>
<div id="ref-shi2020literature" class="csl-entry" role="doc-biblioentry">
Shi, Yuji, Simon Blainey, Chao Sun, and Peng Jing. 2020. <span>“A Literature Review on Accessibility Using Bibliometric Analysis Techniques.”</span> <em>Journal of Transport Geography</em> 87: 102810.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>