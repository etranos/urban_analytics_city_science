<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Emmanouil Tranos">
<meta name="dcterms.date" content="2024-10-07">

<title>Spatial interaction modelling – Urban analytics and city science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../src/apis.html">Practicals</a></li><li class="breadcrumb-item"><a href="../src/sim.html">Spatial interaction modelling</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Urban analytics and city science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/etranos/urban_analytics_city_science" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Content</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/description.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Unit description and aims</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/readings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Key readings</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assessment</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Lectures</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/why_cities.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cities, a very very brief introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/smart_cities.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Smart cities, urban big data, digital twins and other buzz terms</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/intro_networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Networks: an introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/network_science.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Network science, urban laws and scaling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/transport_geography.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Methods in transport geography</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/diversity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Diversity in cities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/Urban_policy___causal_design.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Urban policies and causality</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Practicals</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/apis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">APIs and urban data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/network_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Network analysis practical: networks of cities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/street_networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Street network analysis practical: networks within cities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/network_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Network models in practice</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/sim.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Spatial interaction modelling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/accessibility_full.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Accessibility in practice</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/causality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Causal design and urban policy evaluation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Unit leader</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://etranos.info/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Professor Emmanouil Tranos</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#resources" id="toc-resources" class="nav-link active" data-scroll-target="#resources">Resources</a></li>
  <li><a href="#current-research" id="toc-current-research" class="nav-link" data-scroll-target="#current-research">Current research</a></li>
  <li><a href="#commuting-data-and-networks" id="toc-commuting-data-and-networks" class="nav-link" data-scroll-target="#commuting-data-and-networks">Commuting data and networks</a></li>
  <li><a href="#spatial-interaction-modelling" id="toc-spatial-interaction-modelling" class="nav-link" data-scroll-target="#spatial-interaction-modelling">Spatial interaction modelling</a></li>
  <li><a href="#this-is-not-a-machine-learning-introduction" id="toc-this-is-not-a-machine-learning-introduction" class="nav-link" data-scroll-target="#this-is-not-a-machine-learning-introduction">This is not a Machine Learning introduction…</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../src/apis.html">Practicals</a></li><li class="breadcrumb-item"><a href="../src/sim.html">Spatial interaction modelling</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Spatial interaction modelling</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Emmanouil Tranos </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 7, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="resources" class="level2">
<h2 class="anchored" data-anchor-id="resources">Resources</h2>
<p>Some of the materials for this tutorial have been adapted from:</p>
<ul>
<li><p>the <a href="https://docs.ropensci.org/stplanr/articles/stplanr-od.html">Origin-destination data with stplanr</a> manual,</p></li>
<li><p>the <a href="https://rpubs.com/adam_dennett/376877">Modelling Population Flows Using Spatial Interaction Models</a> tutorial, and</p></li>
<li><p><a href="http://openjournals.wu.ac.at/region/paper_175/175.html"><span class="citation" data-cites="oshan2021spatial">Oshan (<span>2021</span>)</span></a></p></li>
<li><p><a href="https://geocompr.robinlovelace.net/"><span class="citation" data-cites="lovelace2019geocomputation">Lovelace, Nowosad, and Muenchow (<span>2019</span>)</span></a></p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geojsonio)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SpatialPosition)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stargazer)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rprojroot)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">include=</span><span class="cn">TRUE</span>, <span class="at">message=</span><span class="cn">FALSE</span>, <span class="at">warning=</span><span class="cn">FALSE</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the project path</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">find_rstudio_root_file</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="current-research" class="level2">
<h2 class="anchored" data-anchor-id="current-research">Current research</h2>
<p>As an introduction, see <a href="https://etranos.info/post/sad2021/SAD2021.html#/" target="_blank">here</a> some a recent research project we did, which used spatial interaction type of modelling to predict interregional trade flow, which web data <span class="citation" data-cites="tranos2022using">(<a href="#ref-tranos2022using" role="doc-biblioref">Tranos, Carrascal-Incera, and Willis 2022</a>)</span>.</p>
</section>
<section id="commuting-data-and-networks" class="level2">
<h2 class="anchored" data-anchor-id="commuting-data-and-networks">Commuting data and networks</h2>
<p>This the same data and the same data preparation we did for the <a href="https://etranos.info/urban_analytics_city_science/src/network_analysis.html">network analysis practical</a>. Please follow the below workflow, which you should already be familiar with. Once the data preperation is done, we will model these commuting flows.</p>
<p>For this tutorial we will use travel to work data from the 2011 UK Census. The data is available <a href="http://wicid.ukdataservice.ac.uk/cider/wicid/downloads.php?wicid_Session=742d61be88b0614c3982455e542bc776">online</a>, but it requires an academic login. After you log in, download the <strong>WU03UK</strong> element, save the .csv on your working directory under a <code>/data</code> directory and unzip it. We will use the:</p>
<blockquote class="blockquote">
<p>Location of usual residence and place of work by method of travel to work</p>
</blockquote>
<p>for</p>
<blockquote class="blockquote">
<p>Census Merged local authority districts in England and Wales, Council areas in Scotland, Local government districts in Northern Ireland.</p>
</blockquote>
<p>The below code loads the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>path.data <span class="ot">&lt;-</span> <span class="fu">paste0</span>(path, <span class="st">"/data/wu03uk_v3/wu03uk_v3.csv"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>commuting <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(path.data)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>commuting</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 110,162 × 14
   `Area of usual residence` `Area of workplace` All categories: Method of tra…¹
   &lt;chr&gt;                     &lt;chr&gt;                                         &lt;dbl&gt;
 1 95AA                      95AA                                           9465
 2 95AA                      95BB                                            107
 3 95AA                      95CC                                             42
 4 95AA                      95DD                                           1485
 5 95AA                      95EE                                             35
 6 95AA                      95FF                                             18
 7 95AA                      95GG                                           4538
 8 95AA                      95HH                                            139
 9 95AA                      95II                                            282
10 95AA                      95JJ                                            108
# ℹ 110,152 more rows
# ℹ abbreviated name: ¹​`All categories: Method of travel to work`
# ℹ 11 more variables: `Work mainly at or from home` &lt;dbl&gt;,
#   `Underground, metro, light rail, tram` &lt;dbl&gt;, Train &lt;dbl&gt;,
#   `Bus, minibus or coach` &lt;dbl&gt;, Taxi &lt;dbl&gt;,
#   `Motorcycle, scooter or moped` &lt;dbl&gt;, `Driving a car or van` &lt;dbl&gt;,
#   `Passenger in a car or van` &lt;dbl&gt;, Bicycle &lt;dbl&gt;, `On foot` &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>You might have observe some weird codes (OD0000001, OD0000002, OD0000003 and OD0000004). With some simple Google searching we can find the <a href="https://www.ons.gov.uk/file?uri=/census/2011census/2011censusdata/originanddestinationdata/secureoriginanddestinationtables/2011censusoduserguide_tcm77-383888.pdf">2011 Census Origin-Destination Data User Guide</a>, which indicates that these codes do not refer to local authorities:</p>
<ul>
<li><p>OD0000001 = Mainly work at or from home</p></li>
<li><p>OD0000002 = Offshore installation</p></li>
<li><p>OD0000003 = No fixed place</p></li>
<li><p>OD0000004 = Outside UK</p></li>
</ul>
<p>For the sake of simplicity we will remove these non-geographical nodes.</p>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>non.la <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"OD0000001"</span>, <span class="st">"OD0000002"</span>, <span class="st">"OD0000003"</span>, <span class="st">"OD0000004"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>commuting <span class="ot">&lt;-</span> commuting <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="st">`</span><span class="at">Area of workplace</span><span class="st">`</span> <span class="sc">%in%</span> non.la)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>check the <code>%in%</code> <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/match.html">operator</a>.</p>
<p>Now let’s do some clean-up of the <code>commuting</code> data frame. Let’s remind ourselves how the data look like</p>
<p>We are keeping the English and Wales local authorities by keeping the observations with a local authority code starting from E (for England) and W (for Wales).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>commuting <span class="ot">&lt;-</span> commuting <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">startsWith</span>(<span class="st">`</span><span class="at">Area of usual residence</span><span class="st">`</span>, <span class="st">"E"</span>) <span class="sc">|</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">startsWith</span>(<span class="st">`</span><span class="at">Area of usual residence</span><span class="st">`</span>, <span class="st">"W"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">filter</span>(<span class="fu">startsWith</span>(<span class="st">`</span><span class="at">Area of workplace</span><span class="st">`</span>, <span class="st">"E"</span>) <span class="sc">|</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">startsWith</span>(<span class="st">`</span><span class="at">Area of workplace</span><span class="st">`</span>, <span class="st">"W"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 93,034
Columns: 14
$ `Area of usual residence`                  &lt;chr&gt; "E41000001", "E41000001", "…
$ `Area of workplace`                        &lt;chr&gt; "E41000001", "E41000002", "…
$ `All categories: Method of travel to work` &lt;dbl&gt; 20777, 1591, 534, 3865, 433…
$ `Work mainly at or from home`              &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ `Underground, metro, light rail, tram`     &lt;dbl&gt; 6, 1, 0, 1, 0, 0, 0, 0, 0, …
$ Train                                      &lt;dbl&gt; 26, 32, 0, 49, 11, 0, 0, 0,…
$ `Bus, minibus or coach`                    &lt;dbl&gt; 1922, 140, 21, 167, 7, 0, 0…
$ Taxi                                       &lt;dbl&gt; 527, 11, 4, 20, 1, 0, 0, 0,…
$ `Motorcycle, scooter or moped`             &lt;dbl&gt; 107, 6, 6, 23, 4, 0, 0, 0, …
$ `Driving a car or van`                     &lt;dbl&gt; 11788, 1225, 448, 3144, 360…
$ `Passenger in a car or van`                &lt;dbl&gt; 1965, 99, 36, 365, 33, 0, 0…
$ Bicycle                                    &lt;dbl&gt; 593, 13, 1, 29, 2, 0, 0, 0,…
$ `On foot`                                  &lt;dbl&gt; 3789, 60, 16, 60, 15, 0, 0,…
$ `Other method of travel to work`           &lt;dbl&gt; 54, 4, 2, 7, 0, 0, 0, 0, 0,…</code></pre>
</div>
</div>
<p>We can also see we many rows we dropped with <code>glimpse()</code>.</p>
<p>It is very important to distinguish between intra- and inter-local authority flows. In network analysis terms, these are the values we find on the diagonal of an adjacency matrix and refer to the commuting flows within a specific local authority or between different ones. For this exercise we are dropping the intra-local authority flows. Although not used here, we also create a new object with the intra-local authority flows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>commuting.intra <span class="ot">&lt;-</span> commuting <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="st">`</span><span class="at">Area of usual residence</span><span class="st">`</span> <span class="sc">==</span> <span class="st">`</span><span class="at">Area of workplace</span><span class="st">`</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>commuting <span class="ot">&lt;-</span> commuting <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="st">`</span><span class="at">Area of usual residence</span><span class="st">`</span> <span class="sc">!=</span> <span class="st">`</span><span class="at">Area of workplace</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 92,688
Columns: 14
$ `Area of usual residence`                  &lt;chr&gt; "E41000001", "E41000001", "…
$ `Area of workplace`                        &lt;chr&gt; "E41000002", "E41000003", "…
$ `All categories: Method of travel to work` &lt;dbl&gt; 1591, 534, 3865, 433, 5, 2,…
$ `Work mainly at or from home`              &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ `Underground, metro, light rail, tram`     &lt;dbl&gt; 1, 0, 1, 0, 0, 0, 0, 0, 0, …
$ Train                                      &lt;dbl&gt; 32, 0, 49, 11, 0, 0, 0, 0, …
$ `Bus, minibus or coach`                    &lt;dbl&gt; 140, 21, 167, 7, 0, 0, 0, 1…
$ Taxi                                       &lt;dbl&gt; 11, 4, 20, 1, 0, 0, 0, 0, 0…
$ `Motorcycle, scooter or moped`             &lt;dbl&gt; 6, 6, 23, 4, 0, 0, 0, 0, 0,…
$ `Driving a car or van`                     &lt;dbl&gt; 1225, 448, 3144, 360, 5, 2,…
$ `Passenger in a car or van`                &lt;dbl&gt; 99, 36, 365, 33, 0, 0, 0, 0…
$ Bicycle                                    &lt;dbl&gt; 13, 1, 29, 2, 0, 0, 0, 0, 0…
$ `On foot`                                  &lt;dbl&gt; 60, 16, 60, 15, 0, 0, 0, 0,…
$ `Other method of travel to work`           &lt;dbl&gt; 4, 2, 7, 0, 0, 0, 0, 0, 0, …</code></pre>
</div>
</div>
<p>Please note the constant use of <code>glimpse()</code> to keep control of how many observations we have and check if we missed anything.</p>
<p>Also, take a note of the <code>commuting</code> object, which includes multiple types of commuting flows. Therefore, we will build <span class="math inline">\(3\)</span> different networks:</p>
<ol type="1">
<li><p>one for all the commuting flows</p></li>
<li><p>one only for train flows</p></li>
<li><p>one only for bicycle flows.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>commuting.all <span class="ot">&lt;-</span> commuting <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Area of usual residence</span><span class="st">`</span>,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">Area of workplace</span><span class="st">`</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">o =</span> <span class="st">`</span><span class="at">Area of usual residence</span><span class="st">`</span>,     <span class="co"># Area of usual residence is annoyingly</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">d =</span> <span class="st">`</span><span class="at">Area of workplace</span><span class="st">`</span>,           <span class="co"># long, so I am renaiming theses columns</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">weight =</span> <span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># just FYI this is how you could have achieved the same output using base R</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co"># instead of dplyr of the tidyverse ecosystem</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># commuting.all &lt;- commuting[,1:3]</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># names(commuting.all)[1] &lt;- "o"</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co"># names(commuting.all)[2] &lt;- "d"</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co"># names(commuting.all)[3] &lt;- "weight"</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>commuting.train <span class="ot">&lt;-</span> commuting <span class="sc">%&gt;%</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Area of usual residence</span><span class="st">`</span>,</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Area of workplace</span><span class="st">`</span>,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span>,</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Train</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">o =</span> <span class="st">`</span><span class="at">Area of usual residence</span><span class="st">`</span>,</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">d =</span> <span class="st">`</span><span class="at">Area of workplace</span><span class="st">`</span>,</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">weight =</span> <span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The below code drops all the lines with 0 train flows in order to exclude</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># these edges from the network.</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Train<span class="sc">!=</span><span class="dv">0</span>)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>commuting.bicycle <span class="ot">&lt;-</span> commuting <span class="sc">%&gt;%</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Area of usual residence</span><span class="st">`</span>,</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">Area of workplace</span><span class="st">`</span>,</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span>,</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">Bicycle</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">o =</span> <span class="st">`</span><span class="at">Area of usual residence</span><span class="st">`</span>,</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">d =</span> <span class="st">`</span><span class="at">Area of workplace</span><span class="st">`</span>,</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">weight =</span> <span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The below code drops all the lines with 0 bicycle flows in order to exclude</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># these edges from the network.</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Bicycle<span class="sc">!=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Unless you know the local authority codes by hard, it might be useful to also add the corresponding local authority names. These can be easily obtained from the <a href="https://geoportal.statistics.gov.uk/datasets/ons::cmlad-dec-2011-super-generalised-clipped-boundaries-gb/explore?showTable=true">ONS</a>. The below code directly downloads a <code>GeoJSON</code> file with the local authorities in England and Wales. If you don’t know what a <code>GeoJSON</code> file is, have a look <a href="https://en.wikipedia.org/wiki/GeoJSON">here</a>. Boundary data can also be obtained by <a href="https://borders.ukdataservice.ac.uk/easy_download.html">UK Data Service</a>.</p>
<p>For the time being we are only interested in the local authority names and codes. We will use the spatial object later.</p>
<p><strong>Tip</strong>: the below code downloads the <code>GeoJSON</code> file over the web. If you want to run the code multiple times, it might be faster to download the file ones, save it on your hard drive and the point this location to <code>st_read()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>la <span class="ot">&lt;-</span><span class="fu">st_read</span>(<span class="st">"https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/CMLAD_Dec_2011_SGCB_GB_2022/FeatureServer/0/query?outFields=*&amp;where=1%3D1&amp;f=geojson"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(la) </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>la.names <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(la) <span class="sc">%&gt;%</span> </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cmlad11cd, cmlad11nm)    <span class="co"># all we need is the LA names and codes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="spatial-interaction-modelling" class="level2">
<h2 class="anchored" data-anchor-id="spatial-interaction-modelling">Spatial interaction modelling</h2>
<p>Let’s now move to model these flows. If you remember the basic Gravity model is defined as following:</p>
<p><span class="math display">\[T_{ij} = k \displaystyle \frac{V_i^\lambda M_j^\alpha}{D_{ij}^\beta}\]</span></p>
<p>And if we take the logarithms of both sides of the equation we can transform the Gravity model to something which looks like a linear model:</p>
<p><span class="math display">\[lnT_{ij} = lnk + \lambda lnV_i + \alpha lnM_j - \beta lnD_{ij}\]</span></p>
<p>The above transformed equation can be estimated as a linear model if we assume that <span class="math inline">\(y = lnT_{ij}\)</span>, <span class="math inline">\(c = lnk\)</span>, <span class="math inline">\(x_1 = lnV_i\)</span>, <span class="math inline">\(a_1 = \lambda\)</span> etc. Hence, we can use OLS to estimate the following:</p>
<p><span class="math display">\[lnT_{ij} = lnk + \lambda lnV_i + \alpha lnM_j - \beta lnD_{ij} + e_{ij}\]</span></p>
<p>This is what is known as the log-linear or log-normal transformation.</p>
<p>There are a number of issues with such an approach though. Most importantly, our dependent variable is not continuous, but instead a discrete, positive variable (there are no flows of -324.56 people!). Therefore we need to employ an appropriate estimator and this is what the Poisson regression does. Briefly, if we exponentiate both sides, the above equation can be written as:</p>
<p><span class="math display">\[T_{ij} = e^{lnk + \lambda lnV_i + \alpha lnM_j - \beta lnD_{ij}}\]</span> The above is in the form of the Poisson regression. So, we are interested in modelling <em>not</em> the mean <span class="math inline">\(T_{ij}\)</span> drawn from a normally distributed <span class="math inline">\(T\)</span>, but, instead, the mean <span class="math inline">\(T_{ij}\)</span>, which is the average of the all the flows (i.e.&nbsp;counts) between any <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>. For more details about the Poisson regression have a look at <a href="https://bookdown.org/roback/bookdown-bysh/ch-poissonreg.html#initial-models"><span class="citation" data-cites="roback2021beyond">Roback and Legler (<span>2021</span>)</span></a>. For this practical we will estimate the commuting flows using both OLS and Poisson regressions.</p>
<p>But before we get into the estimation we need to build a data frame, which includes all the necessary variables. These are the origin-destination flows <span class="math inline">\(T\)</span> between <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>, the distance <span class="math inline">\(dist\)</span> between <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> and the characteristics <span class="math inline">\(V\)</span> and <span class="math inline">\(M\)</span> of origin <span class="math inline">\(i\)</span> and destinations <span class="math inline">\(j\)</span> that we believe <em>push</em> and <em>pull</em> individuals to commute.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we use the `SpatialPosition` package and the `CreateDistMatrix()` function to</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate a distance matrix for all local authorities,</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>la.d <span class="ot">&lt;-</span> <span class="fu">CreateDistMatrix</span>(la, la, <span class="at">longlat =</span> T)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># we use as column and row name the local authority codes</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(la.d) <span class="ot">&lt;-</span> la<span class="sc">$</span>cmlad11cd</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(la.d) <span class="ot">&lt;-</span> la<span class="sc">$</span>cmlad11cd</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># This is a matrix of the distances between *all* local authorities. We then use</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># the function as.data.frame.table() to convert this matrix to a data frame each</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co"># line of which represents an origin-destination pair.</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>la.d <span class="ot">&lt;-</span> <span class="fu">as.data.frame.table</span>(la.d, <span class="at">responseName =</span> <span class="st">"value"</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(la.d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 119,716
Columns: 3
$ Var1  &lt;fct&gt; E41000001, E41000002, E41000003, E41000004, E41000005, E41000006…
$ Var2  &lt;fct&gt; E41000001, E41000001, E41000001, E41000001, E41000001, E41000001…
$ value &lt;dbl&gt; 0.00, 14338.99, 20147.01, 12892.19, 23203.28, 175341.09, 164899.…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Please note that the elements of the diagonal are present in this distance matrix.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you want to check that the distances we are correct, use google maps to calculate the distance between E41000001 (Middlesbrough) and E41000002 (Hartlepool). Remember that the la.d is expressed in meters.</p>
<p>What is missing here? Do you remember the intra-zone commuting flows? E.g. the commuters that live and work in Bristol? We had removed these from the network analysis and visualisation element. Because we don’t have information about the distances of the intra-zone commutes, we will exclude them from this analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>la.d <span class="ot">&lt;-</span> la.d <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Var1 <span class="sc">!=</span> Var2) <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 119,370
Columns: 3
$ Var1  &lt;fct&gt; E41000002, E41000003, E41000004, E41000005, E41000006, E41000007…
$ Var2  &lt;fct&gt; E41000001, E41000001, E41000001, E41000001, E41000001, E41000001…
$ value &lt;dbl&gt; 14338.99, 20147.01, 12892.19, 23203.28, 175341.09, 164899.50, 13…</code></pre>
</div>
</div>
<p>What we want to do is to match the data frame with all the distances with the commuting flows data frame. To do that we will (1) create a new data frame for the origin-destination pair and (2) match the two data frames.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>la.d <span class="ot">&lt;-</span> la.d <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ij.code =</span> <span class="fu">paste</span>(Var1, Var2, <span class="at">sep =</span> <span class="st">"_"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 119,370
Columns: 4
$ Var1    &lt;fct&gt; E41000002, E41000003, E41000004, E41000005, E41000006, E410000…
$ Var2    &lt;fct&gt; E41000001, E41000001, E41000001, E41000001, E41000001, E410000…
$ value   &lt;dbl&gt; 14338.99, 20147.01, 12892.19, 23203.28, 175341.09, 164899.50, …
$ ij.code &lt;chr&gt; "E41000002_E41000001", "E41000003_E41000001", "E41000004_E4100…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>commuting <span class="ot">&lt;-</span> commuting <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ij.code =</span> <span class="fu">paste</span>(<span class="st">`</span><span class="at">Area of usual residence</span><span class="st">`</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">Area of workplace</span><span class="st">`</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sep =</span> <span class="st">"_"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 92,688
Columns: 15
$ `Area of usual residence`                  &lt;chr&gt; "E41000001", "E41000001", "…
$ `Area of workplace`                        &lt;chr&gt; "E41000002", "E41000003", "…
$ `All categories: Method of travel to work` &lt;dbl&gt; 1591, 534, 3865, 433, 5, 2,…
$ `Work mainly at or from home`              &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ `Underground, metro, light rail, tram`     &lt;dbl&gt; 1, 0, 1, 0, 0, 0, 0, 0, 0, …
$ Train                                      &lt;dbl&gt; 32, 0, 49, 11, 0, 0, 0, 0, …
$ `Bus, minibus or coach`                    &lt;dbl&gt; 140, 21, 167, 7, 0, 0, 0, 1…
$ Taxi                                       &lt;dbl&gt; 11, 4, 20, 1, 0, 0, 0, 0, 0…
$ `Motorcycle, scooter or moped`             &lt;dbl&gt; 6, 6, 23, 4, 0, 0, 0, 0, 0,…
$ `Driving a car or van`                     &lt;dbl&gt; 1225, 448, 3144, 360, 5, 2,…
$ `Passenger in a car or van`                &lt;dbl&gt; 99, 36, 365, 33, 0, 0, 0, 0…
$ Bicycle                                    &lt;dbl&gt; 13, 1, 29, 2, 0, 0, 0, 0, 0…
$ `On foot`                                  &lt;dbl&gt; 60, 16, 60, 15, 0, 0, 0, 0,…
$ `Other method of travel to work`           &lt;dbl&gt; 4, 2, 7, 0, 0, 0, 0, 0, 0, …
$ ij.code                                    &lt;chr&gt; "E41000001_E41000002", "E41…</code></pre>
</div>
</div>
<p>Before we perform the match, keep a note of how many observations both data frames have in order to check if we loose any observations during the matching. As you can see the commuting data frame has less observations than the la.d one, which includes all the possible origin-destination pairs.</p>
<p>What does it mean? That for some origin-destination pairs there are no commuting flows, which of course makes sense. We need to include these pairs with <span class="math inline">\(flow = 0\)</span> in our data though because the lack of commuting flows <strong>is not</strong> missing data!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>commuting.si <span class="ot">&lt;-</span> <span class="fu">full_join</span>(la.d, commuting, <span class="at">by =</span> <span class="st">"ij.code"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 119,370
Columns: 18
$ Var1                                       &lt;fct&gt; E41000002, E41000003, E4100…
$ Var2                                       &lt;fct&gt; E41000001, E41000001, E4100…
$ value                                      &lt;dbl&gt; 14338.99, 20147.01, 12892.1…
$ ij.code                                    &lt;chr&gt; "E41000002_E41000001", "E41…
$ `Area of usual residence`                  &lt;chr&gt; "E41000002", "E41000003", "…
$ `Area of workplace`                        &lt;chr&gt; "E41000001", "E41000001", "…
$ `All categories: Method of travel to work` &lt;dbl&gt; 990, 558, 2590, 266, 1, 4, …
$ `Work mainly at or from home`              &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, NA, 0,…
$ `Underground, metro, light rail, tram`     &lt;dbl&gt; 0, 1, 0, 0, 0, 0, 0, NA, 0,…
$ Train                                      &lt;dbl&gt; 6, 3, 25, 2, 0, 0, 0, NA, 1…
$ `Bus, minibus or coach`                    &lt;dbl&gt; 58, 8, 87, 6, 0, 0, 0, NA, …
$ Taxi                                       &lt;dbl&gt; 1, 2, 4, 0, 0, 0, 0, NA, 0,…
$ `Motorcycle, scooter or moped`             &lt;dbl&gt; 2, 1, 12, 0, 0, 0, 0, NA, 0…
$ `Driving a car or van`                     &lt;dbl&gt; 783, 499, 2259, 244, 1, 4, …
$ `Passenger in a car or van`                &lt;dbl&gt; 73, 26, 154, 10, 0, 0, 0, N…
$ Bicycle                                    &lt;dbl&gt; 15, 9, 23, 0, 0, 0, 0, NA, …
$ `On foot`                                  &lt;dbl&gt; 52, 8, 24, 4, 0, 0, 0, NA, …
$ `Other method of travel to work`           &lt;dbl&gt; 0, 1, 2, 0, 0, 0, 0, NA, 0,…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Some variables are repetitive or need name change</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>commuting.si <span class="ot">&lt;-</span> commuting.si <span class="sc">%&gt;%</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">i =</span> Var1,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">j =</span> Var2,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">distance =</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">Area of usual residence</span><span class="st">`</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span><span class="st">`</span><span class="at">Area of workplace</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 119,370
Columns: 16
$ i                                          &lt;fct&gt; E41000002, E41000003, E4100…
$ j                                          &lt;fct&gt; E41000001, E41000001, E4100…
$ distance                                   &lt;dbl&gt; 14338.99, 20147.01, 12892.1…
$ ij.code                                    &lt;chr&gt; "E41000002_E41000001", "E41…
$ `All categories: Method of travel to work` &lt;dbl&gt; 990, 558, 2590, 266, 1, 4, …
$ `Work mainly at or from home`              &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, NA, 0,…
$ `Underground, metro, light rail, tram`     &lt;dbl&gt; 0, 1, 0, 0, 0, 0, 0, NA, 0,…
$ Train                                      &lt;dbl&gt; 6, 3, 25, 2, 0, 0, 0, NA, 1…
$ `Bus, minibus or coach`                    &lt;dbl&gt; 58, 8, 87, 6, 0, 0, 0, NA, …
$ Taxi                                       &lt;dbl&gt; 1, 2, 4, 0, 0, 0, 0, NA, 0,…
$ `Motorcycle, scooter or moped`             &lt;dbl&gt; 2, 1, 12, 0, 0, 0, 0, NA, 0…
$ `Driving a car or van`                     &lt;dbl&gt; 783, 499, 2259, 244, 1, 4, …
$ `Passenger in a car or van`                &lt;dbl&gt; 73, 26, 154, 10, 0, 0, 0, N…
$ Bicycle                                    &lt;dbl&gt; 15, 9, 23, 0, 0, 0, 0, NA, …
$ `On foot`                                  &lt;dbl&gt; 52, 8, 24, 4, 0, 0, 0, NA, …
$ `Other method of travel to work`           &lt;dbl&gt; 0, 1, 2, 0, 0, 0, 0, NA, 0,…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's see if we have any missing values</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(commuting.si, <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                       i 
                                       0 
                                       j 
                                       0 
                                distance 
                                       0 
                                 ij.code 
                                       0 
All categories: Method of travel to work 
                                   26682 
             Work mainly at or from home 
                                   26682 
    Underground, metro, light rail, tram 
                                   26682 
                                   Train 
                                   26682 
                   Bus, minibus or coach 
                                   26682 
                                    Taxi 
                                   26682 
            Motorcycle, scooter or moped 
                                   26682 
                    Driving a car or van 
                                   26682 
               Passenger in a car or van 
                                   26682 
                                 Bicycle 
                                   26682 
                                 On foot 
                                   26682 
          Other method of travel to work 
                                   26682 </code></pre>
</div>
</div>
<p>There are quite a few. What does it mean? That there are no commuting flows for these origin-destination pairs and,therefore, were excluded from the origin commuting data set we downloaded. So, we are going to replace these <span class="math inline">\(NAs\)</span> with <span class="math inline">\(0s\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>commuting.si <span class="ot">&lt;-</span> commuting.si <span class="sc">%&gt;%</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace</span>(., <span class="fu">is.na</span>(.), <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let’s bring data for some <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> characteristics that we believe that affect commuting. I have prepared such a small data set from the census, which includes resident population and working populations as <em>push</em> and <em>pull</em> variables. These data have been obtained by <a href="https://www.nomisweb.co.uk/published/census/odexplorer.asp">nomis</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>data.workplace <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://www.dropbox.com/s/0ym88p8quwaiyau/data_workplace.csv?dl=1"</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Dropbox trick: to use in an .Rmd the link that Dropbox provides to share a file</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># replace dl=0 with dl=1 at the end of the link</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>data.resident <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://www.dropbox.com/s/09d7v5cm6ov3ioz/data_resident.csv?dl=1"</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>commuting.si <span class="ot">&lt;-</span> commuting.si <span class="sc">%&gt;%</span> </span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(data.resident, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'i'</span> <span class="ot">=</span> <span class="st">'Merging.Local.Authority.Code'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(data.workplace, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'j'</span> <span class="ot">=</span> <span class="st">'Merging.Local.Authority.Code'</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" type="alert alert-warning">
<div class="alert alert-warning">
<p>
<strong>Question</strong> are there any redundant columns? Can you remove them?
</p>
</div>
</div>
<p>Before we start modelling these flows, let’s plot our variables.</p>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(commuting.si, <span class="fu">aes</span>(<span class="at">x=</span>distance,</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y=</span><span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="sim_files/figure-html/si.plots-1.png" class="img-fluid" width="672"></p>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(commuting.si, <span class="fu">aes</span>(<span class="at">x=</span>resident,</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y=</span><span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="sim_files/figure-html/si.plots-2.png" class="img-fluid" width="672"></p>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(commuting.si, <span class="fu">aes</span>(<span class="at">x=</span>workplace,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y=</span><span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="sim_files/figure-html/si.plots-3.png" class="img-fluid" width="672"></p>
<div class="cell" type="alert alert-warning">
<div class="alert alert-warning">
<p>
<strong>Question</strong> What do you take from these graphs?
</p>
</div>
</div>
<p>Let’s try now to model these flows. We will start with a simple OLS to estimate the above specifications. Please pay attention to the small trick we did. Because there are non-materialised origin-destination pairs (i.e.&nbsp;with 0 flows), we added a small value (<span class="math inline">\(0.5\)</span>) in the dependent variable. Otherwise we will receive an error as the logarithm of <span class="math inline">\(0\)</span> is not defined.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>ols.model <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(<span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span><span class="sc">+</span>.<span class="dv">5</span>) <span class="sc">~</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">log</span>(distance) <span class="sc">+</span> <span class="fu">log</span>(resident) <span class="sc">+</span> <span class="fu">log</span>(workplace),</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> commuting.si)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># To see the model output you can use the summary() function.</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ols.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(`All categories: Method of travel to work` + 
    0.5) ~ log(distance) + log(resident) + log(workplace), data = commuting.si)

Residuals:
    Min      1Q  Median      3Q     Max 
-4.2614 -0.7144 -0.0429  0.6430  8.6140 

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)     7.967357   0.106119   75.08   &lt;2e-16 ***
log(distance)  -1.839401   0.004610 -399.01   &lt;2e-16 ***
log(resident)   0.514034   0.005402   95.16   &lt;2e-16 ***
log(workplace)  0.852322   0.005185  164.37   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.104 on 115932 degrees of freedom
  (4816 observations deleted due to missingness)
Multiple R-squared:  0.6444,    Adjusted R-squared:  0.6444 
F-statistic: 7.002e+04 on 3 and 115932 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>So, the OLS regression estimated the four parameters:</p>
<ul>
<li><span class="math inline">\(lnk = 7.971\)</span></li>
<li><span class="math inline">\(\beta = -1.840\)</span></li>
<li><span class="math inline">\(\lambda = 0.514\)</span></li>
<li><span class="math inline">\(\alpha = -0.852\)</span></li>
</ul>
<p>Let’s estimate now our model using a Poisson regression. Given that we don’t take the logarithm of the dependent variable, there is no need to add <span class="math inline">\(0.5\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>glm.model <span class="ot">&lt;-</span> <span class="fu">glm</span>((<span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span>)<span class="sc">~</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">log</span>(distance) <span class="sc">+</span> <span class="fu">log</span>(resident) <span class="sc">+</span> <span class="fu">log</span>(workplace),</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>), <span class="at">data =</span> commuting.si)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = (`All categories: Method of travel to work`) ~ 
    log(distance) + log(resident) + log(workplace), family = poisson(link = "log"), 
    data = commuting.si)

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)    11.6641641  0.0091381    1276   &lt;2e-16 ***
log(distance)  -1.8164748  0.0002803   -6480   &lt;2e-16 ***
log(resident)   0.3179209  0.0005444     584   &lt;2e-16 ***
log(workplace)  0.8191649  0.0004200    1951   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 71855219  on 115935  degrees of freedom
Residual deviance: 14104694  on 115932  degrees of freedom
  (4816 observations deleted due to missingness)
AIC: 14447299

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
<p>The following parameter1 have been estimated</p>
<ul>
<li><span class="math inline">\(lnk = 11.635\)</span></li>
<li><span class="math inline">\(\beta = -1.816\)</span></li>
<li><span class="math inline">\(\lambda = 0.319\)</span></li>
<li><span class="math inline">\(\alpha = 0.820\)</span></li>
</ul>
<p>As you can see the differences are rather small.</p>
<p>The <code>stargazer</code> package I use below creates elegant regression tables. Replace <code>type = "html"</code> with <code>type = "text"</code> to have be able to read the results using the .Rmd document. the “html” option is useful for when knitting the script to an .html document.</p>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(ols.model, glm.model, <span class="at">type =</span> <span class="st">"html"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table style="text-align:center">
<tbody><tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td colspan="2">
<em>Dependent variable:</em>
</td>
</tr>
<tr>
<td>
</td>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
log(<code>All categories: Method of travel to work</code> + 0.5)
</td>
<td>
(<code>All categories: Method of travel to work</code>)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
<em>OLS</em>
</td>
<td>
<em>Poisson</em>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(1)
</td>
<td>
(2)
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
log(distance)
</td>
<td>
-1.839<sup>***</sup>
</td>
<td>
-1.816<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.005)
</td>
<td>
(0.0003)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
log(resident)
</td>
<td>
0.514<sup>***</sup>
</td>
<td>
0.318<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.005)
</td>
<td>
(0.001)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
log(workplace)
</td>
<td>
0.852<sup>***</sup>
</td>
<td>
0.819<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.005)
</td>
<td>
(0.0004)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Constant
</td>
<td>
7.967<sup>***</sup>
</td>
<td>
11.664<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.106)
</td>
<td>
(0.009)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Observations
</td>
<td>
115,936
</td>
<td>
115,936
</td>
</tr>
<tr>
<td style="text-align:left">
R<sup>2</sup>
</td>
<td>
0.644
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Adjusted R<sup>2</sup>
</td>
<td>
0.644
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Log Likelihood
</td>
<td>
</td>
<td>
-7,223,645.000
</td>
</tr>
<tr>
<td style="text-align:left">
Akaike Inf. Crit.
</td>
<td>
</td>
<td>
14,447,299.000
</td>
</tr>
<tr>
<td style="text-align:left">
Residual Std. Error
</td>
<td>
1.104 (df = 115932)
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
F Statistic
</td>
<td>
70,016.600<sup>***</sup> (df = 3; 115932)
</td>
<td>
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
<em>Note:</em>
</td>
<td colspan="2" style="text-align:right">
<sup><em></em></sup><em>p&lt;0.1; <sup><strong></strong></sup><strong>p&lt;0.05; <sup></sup></strong></em>p&lt;0.01
</td>
</tr>
</tbody></table>
<div class="cell" type="alert alert-warning">
<div class="alert alert-warning">
<p>
<strong>Question</strong> Can you interpret the regression results?
</p>
</div>
</div>
</section>
<section id="this-is-not-a-machine-learning-introduction" class="level2">
<h2 class="anchored" data-anchor-id="this-is-not-a-machine-learning-introduction">This is not a Machine Learning introduction…</h2>
<p>… but maybe a sneak preview of the philosophy behind <em>modern</em> data science approaches to answer computational problems. We are using the <code>caret</code> package to:</p>
<ul>
<li><p>split our data into test and training</p></li>
<li><p>train a <code>lm()</code>and a <code>glm()</code> model using the training data set</p></li>
<li><p>use the estimated models to make <em>out-of-sample</em> predictions using the test data set</p></li>
<li><p>plot the results and the relevant metrics and choose the best model.</p></li>
</ul>
<p>This is obviously an oversimplification, but it provides a good preview of machine learning frameworks.</p>
<p>It is worth browsing the <a href="https://topepo.github.io/caret/"><code>caret</code></a> package.</p>
<p><strong>The below will take a few minutes!</strong></p>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>commuting.si <span class="ot">&lt;-</span> commuting.si <span class="sc">%&gt;%</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">3456</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>trainIndex <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(commuting.si<span class="sc">$</span><span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span>, <span class="at">p =</span> .<span class="dv">8</span>, </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">list =</span> <span class="cn">FALSE</span>, </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">times =</span> <span class="dv">1</span>)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(trainIndex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>[1] 92751 1</p>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(commuting.si)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>[1] 115936 22</p>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>commuting.si.train <span class="ot">&lt;-</span> commuting.si[ trainIndex,]</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>commuting.si.test  <span class="ot">&lt;-</span> commuting.si[<span class="sc">-</span>trainIndex,]</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>model.lm <span class="ot">&lt;-</span> <span class="fu">train</span>(<span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span> <span class="sc">~</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>                    distance <span class="sc">+</span> resident <span class="sc">+</span> workplace,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> commuting.si,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method =</span> <span class="st">"lm"</span>)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>predictions.lm <span class="ot">&lt;-</span> <span class="fu">predict</span>(model.lm, commuting.si.test)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>lm.metrics <span class="ot">&lt;-</span> <span class="fu">postResample</span>(<span class="at">pred =</span> predictions.lm, <span class="at">obs =</span> commuting.si.test<span class="sc">$</span><span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span>) </span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>model.glm <span class="ot">&lt;-</span> <span class="fu">train</span>(<span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span> <span class="sc">~</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>                    distance <span class="sc">+</span> resident <span class="sc">+</span> workplace,</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> commuting.si,</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method =</span> <span class="st">"glmnet"</span>,</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family =</span> <span class="st">"poisson"</span>, </span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>                    <span class="at">na.action =</span> na.omit)</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>predictions.glm <span class="ot">&lt;-</span> <span class="fu">predict</span>(model.glm, commuting.si.test)</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>glm.metrics <span class="ot">&lt;-</span> <span class="fu">postResample</span>(<span class="at">pred =</span> predictions.glm, <span class="at">obs =</span> commuting.si.test<span class="sc">$</span><span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span>) </span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(lm.metrics, glm.metrics) <span class="sc">%&gt;%</span> </span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="fu">c</span>(<span class="st">"lm"</span>, <span class="st">"glm"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Model, Rsquared, RMSE, MAE) <span class="sc">%&gt;%</span> </span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;">Rsquared</th>
<th style="text-align: right;">RMSE</th>
<th style="text-align: right;">MAE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">lm</td>
<td style="text-align: right;">0.067</td>
<td style="text-align: right;">824.067</td>
<td style="text-align: right;">214.033</td>
</tr>
<tr class="even">
<td style="text-align: left;">glm</td>
<td style="text-align: right;">0.422</td>
<td style="text-align: right;">687.811</td>
<td style="text-align: right;">112.527</td>
</tr>
</tbody>
</table>
<div class="cell" type="alert alert-warning">
<div class="alert alert-warning">
<p>
<strong>Question</strong> Which model would you choose?
</p>
</div>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>predict.lm.plot <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(commuting.si.test<span class="sc">$</span><span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span>, predictions.lm) <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">y =</span> <span class="st">'...1'</span>,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">y_hat =</span> <span class="st">'...2'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>y, <span class="at">y=</span>y_hat)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"lm"</span>) <span class="sc">+</span> </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>predict.glm.plot <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(commuting.si.test<span class="sc">$</span><span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span>, predictions.glm) <span class="sc">%&gt;%</span> </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">y =</span> <span class="st">'...1'</span>,</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">y_hat =</span> <span class="st">'...2'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>y, <span class="at">y=</span>y_hat)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"glm"</span>) <span class="sc">+</span> </span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>predict.lm.plot <span class="sc">+</span> predict.glm.plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="sim_files/figure-html/predict.plots-1.png" class="img-fluid" width="672"></p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-lovelace2019geocomputation" class="csl-entry" role="listitem">
Lovelace, Robin, Jakub Nowosad, and Jannes Muenchow. 2019. <em>Geocomputation with r</em>. Chapman; Hall/CRC.
</div>
<div id="ref-oshan2021spatial" class="csl-entry" role="listitem">
Oshan, Taylor M. 2021. <span>“The Spatial Structure Debate in Spatial Interaction Modeling: 50 Years On.”</span> <em>Progress in Human Geography</em> 45 (5): 925–50.
</div>
<div id="ref-roback2021beyond" class="csl-entry" role="listitem">
Roback, Paul, and Julie Legler. 2021. <em>Beyond Multiple Linear Regression: Applied Generalized Linear Models and Multilevel Models in r</em>. Chapman; Hall/CRC.
</div>
<div id="ref-tranos2022using" class="csl-entry" role="listitem">
Tranos, Emmanouil, André Carrascal-Incera, and George Willis. 2022. <span>“Using the Web to Predict Regional Trade Flows: Data Extraction, Modeling, and Validation.”</span> <em>Annals of the American Association of Geographers</em>, 1–23.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>