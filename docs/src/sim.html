<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.37">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Emmanouil Tranos">
<meta name="dcterms.date" content="2022-11-14">

<title>Urban analytics and city science - Spatial interaction modelling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Spatial interaction modelling</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Urban analytics and city science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/etranos/urban_analytics_city_science" title="" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Content</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/description.html" class="sidebar-item-text sidebar-link">Unit description and aims</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/syllabus.html" class="sidebar-item-text sidebar-link">Syllabus</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/readings.html" class="sidebar-item-text sidebar-link">Key readings</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/project.html" class="sidebar-item-text sidebar-link">Assessment</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Lectures</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/why_cities.html" class="sidebar-item-text sidebar-link">Cities, a very very brief introduction</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/smart_cities.html" class="sidebar-item-text sidebar-link">Smart cities, urban big data, digital twins and other buzz terms</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/intro_networks.html" class="sidebar-item-text sidebar-link">Networks: an introduction</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/network_science.html" class="sidebar-item-text sidebar-link">Network science, urban laws and scaling</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/transport_geography.html" class="sidebar-item-text sidebar-link">Methods in transport geography</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/diversity.html" class="sidebar-item-text sidebar-link">Diversity in cities</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Practicals</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/apis.html" class="sidebar-item-text sidebar-link">APIs and urban data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/network_analysis.html" class="sidebar-item-text sidebar-link">Network analysis practical: networks of cities</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/street_networks.html" class="sidebar-item-text sidebar-link">Street network analysis practical: networks within cities</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/network_models.html" class="sidebar-item-text sidebar-link">Network models in practice</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/accessibility_full.html" class="sidebar-item-text sidebar-link">Accessibility in practice</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/sim.html" class="sidebar-item-text sidebar-link active">Spatial interaction modelling</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">Unit leader</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/author.html" class="sidebar-item-text sidebar-link">Professor Emmanouil Tranos</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#resources" id="toc-resources" class="nav-link active" data-scroll-target="#resources">Resources</a></li>
  <li><a href="#current-research" id="toc-current-research" class="nav-link" data-scroll-target="#current-research">Current research</a></li>
  <li><a href="#commuting-data-and-networks" id="toc-commuting-data-and-networks" class="nav-link" data-scroll-target="#commuting-data-and-networks">Commuting data and networks</a></li>
  <li><a href="#spatial-interaction-modelling" id="toc-spatial-interaction-modelling" class="nav-link" data-scroll-target="#spatial-interaction-modelling">Spatial interaction modelling</a></li>
  <li><a href="#this-is-not-a-machine-learning-introduction" id="toc-this-is-not-a-machine-learning-introduction" class="nav-link" data-scroll-target="#this-is-not-a-machine-learning-introduction">This is not a Machine Learning introduction…</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Spatial interaction modelling</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Emmanouil Tranos </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 14, 2022</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="resources" class="level2">
<h2 class="anchored" data-anchor-id="resources">Resources</h2>
<p>Some of the materials for this tutorial have been adapted from:</p>
<ul>
<li><p>the <a href="https://docs.ropensci.org/stplanr/articles/stplanr-od.html">Origin-destination data with stplanr</a> manual,</p></li>
<li><p>the <a href="https://rpubs.com/adam_dennett/376877">Modelling Population Flows Using Spatial Interaction Models</a> tutorial, and</p></li>
<li><p><a href="http://openjournals.wu.ac.at/region/paper_175/175.html">Oshan (2016)</a></p></li>
<li><p><a href="https://geocompr.robinlovelace.net/">Lovelace, Robin, Jakub Nowosad, and Jannes Muenchow. Geocomputation with R. CRC Press, 2019</a></p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tidyverse' was built under R version 4.1.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'ggplot2' was built under R version 4.1.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tibble' was built under R version 4.1.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tidyr' was built under R version 4.1.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'readr' was built under R version 4.1.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'dplyr' was built under R version 4.1.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geojsonio)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SpatialPosition)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'SpatialPosition' was built under R version 4.1.1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stargazer)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'caret' was built under R version 4.1.1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rprojroot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'rprojroot' was built under R version 4.1.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'sf' was built under R version 4.1.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">include=</span><span class="cn">TRUE</span>, <span class="at">results=</span> <span class="st">'hide'</span>, <span class="at">message=</span><span class="cn">FALSE</span>, <span class="at">warning=</span><span class="cn">FALSE</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the project path</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">find_rstudio_root_file</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="current-research" class="level2">
<h2 class="anchored" data-anchor-id="current-research">Current research</h2>
<p>As an introduction, see <a href="https://etranos.info/post/sad2021/SAD2021.html#/" target="_blank">here</a> some a recent research project we did, which used spatial interaction type of modelling to predict interregional trade flow, which web data <span class="citation" data-cites="tranos2022using">[@tranos2022using]</span>.</p>
</section>
<section id="commuting-data-and-networks" class="level2">
<h2 class="anchored" data-anchor-id="commuting-data-and-networks">Commuting data and networks</h2>
<p>This the same data and the same data preparation we did for the <a href="https://etranos.info/urban_analytics_city_science/src/network_analysis.html">network analysis practical</a>. Please follow the below workflow, which you should already be familiar with. Once the data preperation is done, we will model these commuting flows.</p>
<p>For this tutorial we will use travel to work data from the 2011 UK Census. The data is available <a href="http://wicid.ukdataservice.ac.uk/cider/wicid/downloads.php?wicid_Session=742d61be88b0614c3982455e542bc776">online</a>, but it requires an academic login. After you log in, download the <strong>WU03UK</strong> element, save the .csv on your working directory under a <code>/data</code> directory and unzip it. We will use the:</p>
<blockquote class="blockquote">
<p>Location of usual residence and place of work by method of travel to work</p>
</blockquote>
<p>for</p>
<blockquote class="blockquote">
<p>Census Merged local authority districts in England and Wales, Council areas in Scotland, Local government districts in Northern Ireland.</p>
</blockquote>
<p>The below code loads the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>path.data <span class="ot">&lt;-</span> <span class="fu">paste0</span>(path, <span class="st">"/data/wu03uk_v3/wu03uk_v3.csv"</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>commuting <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(path.data)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(commuting)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You might have observe some weird codes (OD0000001, OD0000002, OD0000003 and OD0000004). With some simple Google searching we can find the <a href="https://www.ons.gov.uk/file?uri=/census/2011census/2011censusdata/originanddestinationdata/secureoriginanddestinationtables/2011censusoduserguide_tcm77-383888.pdf">2011 Census Origin-Destination Data User Guide</a>, which indicates that these codes do not refer to local authorities:</p>
<ul>
<li><p>OD0000001 = Mainly work at or from home</p></li>
<li><p>OD0000002 = Offshore installation</p></li>
<li><p>OD0000003 = No fixed place</p></li>
<li><p>OD0000004 = Outside UK</p></li>
</ul>
<p>For the sake of simplicity we will remove these non-geographical nodes.</p>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>non.la <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"OD0000001"</span>, <span class="st">"OD0000002"</span>, <span class="st">"OD0000003"</span>, <span class="st">"OD0000004"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>commuting <span class="ot">&lt;-</span> commuting <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="st">`</span><span class="at">Area of workplace</span><span class="st">`</span> <span class="sc">%in%</span> non.la)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>check the <code>%in%</code> <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/match.html">operator</a>.</p>
<p>Now let’s do some clean-up of the <code>commuting</code> data frame. Let’s remind ourselves how the data look like</p>
<p>We are keeping the English and Wales local authorities by keeping the observations with a local authority code starting from E (for England) and W (for Wales).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>commuting <span class="ot">&lt;-</span> commuting <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">startsWith</span>(<span class="st">`</span><span class="at">Area of usual residence</span><span class="st">`</span>, <span class="st">"E"</span>) <span class="sc">|</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">startsWith</span>(<span class="st">`</span><span class="at">Area of usual residence</span><span class="st">`</span>, <span class="st">"W"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">filter</span>(<span class="fu">startsWith</span>(<span class="st">`</span><span class="at">Area of workplace</span><span class="st">`</span>, <span class="st">"E"</span>) <span class="sc">|</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">startsWith</span>(<span class="st">`</span><span class="at">Area of workplace</span><span class="st">`</span>, <span class="st">"W"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 93,034
Columns: 14
$ `Area of usual residence`                  &lt;chr&gt; "E41000001", "E41000001", "~
$ `Area of workplace`                        &lt;chr&gt; "E41000001", "E41000002", "~
$ `All categories: Method of travel to work` &lt;dbl&gt; 20777, 1591, 534, 3865, 433~
$ `Work mainly at or from home`              &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, ~
$ `Underground, metro, light rail, tram`     &lt;dbl&gt; 6, 1, 0, 1, 0, 0, 0, 0, 0, ~
$ Train                                      &lt;dbl&gt; 26, 32, 0, 49, 11, 0, 0, 0,~
$ `Bus, minibus or coach`                    &lt;dbl&gt; 1922, 140, 21, 167, 7, 0, 0~
$ Taxi                                       &lt;dbl&gt; 527, 11, 4, 20, 1, 0, 0, 0,~
$ `Motorcycle, scooter or moped`             &lt;dbl&gt; 107, 6, 6, 23, 4, 0, 0, 0, ~
$ `Driving a car or van`                     &lt;dbl&gt; 11788, 1225, 448, 3144, 360~
$ `Passenger in a car or van`                &lt;dbl&gt; 1965, 99, 36, 365, 33, 0, 0~
$ Bicycle                                    &lt;dbl&gt; 593, 13, 1, 29, 2, 0, 0, 0,~
$ `On foot`                                  &lt;dbl&gt; 3789, 60, 16, 60, 15, 0, 0,~
$ `Other method of travel to work`           &lt;dbl&gt; 54, 4, 2, 7, 0, 0, 0, 0, 0,~</code></pre>
</div>
</div>
<p>We can also see we many rows we dropped with <code>glimpse()</code>.</p>
<p>It is very important to distinguish between intra- and inter-local authority flows. In network analysis terms, these are the values we find on the diagonal of an adjacency matrix and refer to the commuting flows within a specific local authority or between different ones. For this exercise we are dropping the intra-local authority flows. Although not used here, we also create a new object with the intra-local authority flows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>commuting.intra <span class="ot">&lt;-</span> commuting <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="st">`</span><span class="at">Area of usual residence</span><span class="st">`</span> <span class="sc">==</span> <span class="st">`</span><span class="at">Area of workplace</span><span class="st">`</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>commuting <span class="ot">&lt;-</span> commuting <span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="st">`</span><span class="at">Area of usual residence</span><span class="st">`</span> <span class="sc">!=</span> <span class="st">`</span><span class="at">Area of workplace</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 92,688
Columns: 14
$ `Area of usual residence`                  &lt;chr&gt; "E41000001", "E41000001", "~
$ `Area of workplace`                        &lt;chr&gt; "E41000002", "E41000003", "~
$ `All categories: Method of travel to work` &lt;dbl&gt; 1591, 534, 3865, 433, 5, 2,~
$ `Work mainly at or from home`              &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, ~
$ `Underground, metro, light rail, tram`     &lt;dbl&gt; 1, 0, 1, 0, 0, 0, 0, 0, 0, ~
$ Train                                      &lt;dbl&gt; 32, 0, 49, 11, 0, 0, 0, 0, ~
$ `Bus, minibus or coach`                    &lt;dbl&gt; 140, 21, 167, 7, 0, 0, 0, 1~
$ Taxi                                       &lt;dbl&gt; 11, 4, 20, 1, 0, 0, 0, 0, 0~
$ `Motorcycle, scooter or moped`             &lt;dbl&gt; 6, 6, 23, 4, 0, 0, 0, 0, 0,~
$ `Driving a car or van`                     &lt;dbl&gt; 1225, 448, 3144, 360, 5, 2,~
$ `Passenger in a car or van`                &lt;dbl&gt; 99, 36, 365, 33, 0, 0, 0, 0~
$ Bicycle                                    &lt;dbl&gt; 13, 1, 29, 2, 0, 0, 0, 0, 0~
$ `On foot`                                  &lt;dbl&gt; 60, 16, 60, 15, 0, 0, 0, 0,~
$ `Other method of travel to work`           &lt;dbl&gt; 4, 2, 7, 0, 0, 0, 0, 0, 0, ~</code></pre>
</div>
</div>
<p>Please note the constant use of <code>glimpse()</code> to keep control of how many observations we have and check if we missed anything.</p>
<p>Also, take a note of the <code>commuting</code> object, which includes multiple types of commuting flows. Therefore, we will build <span class="math inline">\(3\)</span> different networks:</p>
<ol type="1">
<li><p>one for all the commuting flows</p></li>
<li><p>one only for train flows</p></li>
<li><p>one only for bicycle flows.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>commuting.all <span class="ot">&lt;-</span> commuting <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Area of usual residence</span><span class="st">`</span>,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">Area of workplace</span><span class="st">`</span>,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">o =</span> <span class="st">`</span><span class="at">Area of usual residence</span><span class="st">`</span>,     <span class="co"># Area of usual residence is annoyingly</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">d =</span> <span class="st">`</span><span class="at">Area of workplace</span><span class="st">`</span>,           <span class="co"># long, so I am renaiming theses columns</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">weight =</span> <span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co"># just FYI this is how you could have achieved the same output using base R</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co"># instead of dplyr of the tidyverse ecosystem</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co"># commuting.all &lt;- commuting[,1:3]</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co"># names(commuting.all)[1] &lt;- "o"</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="co"># names(commuting.all)[2] &lt;- "d"</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co"># names(commuting.all)[3] &lt;- "weight"</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>commuting.train <span class="ot">&lt;-</span> commuting <span class="sc">%&gt;%</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Area of usual residence</span><span class="st">`</span>,</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Area of workplace</span><span class="st">`</span>,</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span>,</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Train</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">o =</span> <span class="st">`</span><span class="at">Area of usual residence</span><span class="st">`</span>,</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">d =</span> <span class="st">`</span><span class="at">Area of workplace</span><span class="st">`</span>,</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">weight =</span> <span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The below code drops all the lines with 0 train flows in order to exclude</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># these edges from the network.</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Train<span class="sc">!=</span><span class="dv">0</span>)</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>commuting.bicycle <span class="ot">&lt;-</span> commuting <span class="sc">%&gt;%</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Area of usual residence</span><span class="st">`</span>,</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">Area of workplace</span><span class="st">`</span>,</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span>,</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">Bicycle</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">o =</span> <span class="st">`</span><span class="at">Area of usual residence</span><span class="st">`</span>,</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">d =</span> <span class="st">`</span><span class="at">Area of workplace</span><span class="st">`</span>,</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">weight =</span> <span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The below code drops all the lines with 0 bicycle flows in order to exclude</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># these edges from the network.</span></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Bicycle<span class="sc">!=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Unless you know the local authority codes by hard, it might be useful to also add the corresponding local authority names. These can be easily obtained from the <a href="https://geoportal.statistics.gov.uk/datasets/ons::census-merged-local-authority-districts-december-2011-generalised-clipped-boundaries-in-great-britain/about">ONS</a>. The below code directly downloads a <code>GeoJSON</code> file with the local authorities in England and Wales. If you don’t know what a <code>GeoJSON</code> file is, have a look <a href="https://en.wikipedia.org/wiki/GeoJSON">here</a>. Boundary data can also be obtained by <a href="https://borders.ukdataservice.ac.uk/easy_download.html">UK Data Service</a>.</p>
<p>For the time being we are only interested in the local authority names and codes. We will use the spatial object later.</p>
<p><strong>Tip</strong>: the below code downloads the <code>GeoJSON</code> file over the web. If you want to run the code multiple times, it might be faster to download the file ones, save it on your hard drive and the point this location to <code>st_read()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>la <span class="ot">&lt;-</span><span class="fu">st_read</span>(<span class="st">"https://opendata.arcgis.com/datasets/d54f953d633b45f5a82fdd3c89b4c955_0.geojson"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(la) </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>la.names <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(la) <span class="sc">%&gt;%</span> </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cmlad11cd, cmlad11nm)    <span class="co"># all we need is the LA names and codes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="spatial-interaction-modelling" class="level2">
<h2 class="anchored" data-anchor-id="spatial-interaction-modelling">Spatial interaction modelling</h2>
<p>Let’s now move to model these flows. If you remember the basic Gravity model is defined as following:</p>
<p><span class="math display">\[T_{ij} = k \displaystyle \frac{V_i^\lambda M_j^\alpha}{D_{ij}^\beta}\]</span></p>
<p>And if we take the logarithms of both sides of the equation we can transform the Gravity model to something which looks like a linear model:</p>
<p><span class="math display">\[lnT_{ij} = lnk + \lambda lnV_i + \alpha lnM_j - \beta lnD_{ij}\]</span></p>
<p>The above transformed equation can be estimated as a linear model if we assume that <span class="math inline">\(y = lnT_{ij}\)</span>, <span class="math inline">\(c = lnk\)</span>, <span class="math inline">\(x_1 = lnV_i\)</span>, <span class="math inline">\(a_1 = \lambda\)</span> etc. Hence, we can use OLS to estimate the following:</p>
<p><span class="math display">\[lnT_{ij} = lnk + \lambda lnV_i + \alpha lnM_j - \beta lnD_{ij} + e_{ij}\]</span></p>
<p>This is what is known as the log-linear or log-normal transformation.</p>
<p>There are a number of issues with such an approach though. Most importantly, our dependent variable is not continuous, but instead a discrete, positive variable (there are no flows of -324.56 people!). Therefore we need to employ an appropriate estimator and this is what the Poisson regression does. Briefly, if we exponentiate both sides, the above equation can be written as:</p>
<p><span class="math display">\[T_{ij} = e^{lnk + \lambda lnV_i + \alpha lnM_j - \beta lnD_{ij}}\]</span> The above is in the form of the Poisson regression. So, we are interested in modelling <em>not</em> the mean <span class="math inline">\(T_{ij}\)</span> drawn from a normally distributed <span class="math inline">\(T\)</span>, but, instead, the mean <span class="math inline">\(T_{ij}\)</span>, which is the average of the all the flows (i.e.&nbsp;counts) between any <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>. For more details about the Poisson regression have a look at the (Legler and Roback 2019)[https://bookdown.org/roback/bookdown-bysh/ch-poissonreg.html#initial-models]. For this practical we will estimate the commuting flows using both OLS and Poisson regressions.</p>
<p>But before we get into the estimation we need to build a data frame, which includes all the necessary variables. These are the origin-destination flows <span class="math inline">\(T\)</span> between <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>, the distance <span class="math inline">\(dist\)</span> between <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> and the characteristics <span class="math inline">\(V\)</span> and <span class="math inline">\(M\)</span> of origin <span class="math inline">\(i\)</span> and destinations <span class="math inline">\(j\)</span> that we believe <em>push</em> and <em>pull</em> individuals to commute.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we use the `SpatialPosition` package and the `CreateDistMatrix()` function to</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate a distance matrix for all local authorities,</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>la.d <span class="ot">&lt;-</span> <span class="fu">CreateDistMatrix</span>(la, la, <span class="at">longlat =</span> T)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># we use as column and row name the local authority codes</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(la.d) <span class="ot">&lt;-</span> la<span class="sc">$</span>cmlad11cd</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(la.d) <span class="ot">&lt;-</span> la<span class="sc">$</span>cmlad11cd</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co"># This is a matrix of the distances between *all* local authorities. We then use</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co"># the function as.data.frame.table() to convert this matrix to a data frame each</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co"># line of which represents an origin-destination pair.</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>la.d <span class="ot">&lt;-</span> <span class="fu">as.data.frame.table</span>(la.d, <span class="at">responseName =</span> <span class="st">"value"</span>)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(la.d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 119,716
Columns: 3
$ Var1  &lt;fct&gt; E41000001, E41000002, E41000003, E41000004, E41000005, E41000006~
$ Var2  &lt;fct&gt; E41000001, E41000001, E41000001, E41000001, E41000001, E41000001~
$ value &lt;dbl&gt; 0.00, 14370.86, 20185.71, 11427.54, 23175.73, 175329.74, 164912.~</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Please note that the elements of the diagonal are present in this distance matrix.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you want to check that the distances we are correct, use google maps to calculate the distance between E41000001 (Middlesbrough) and E41000002 (Hartlepool). Remember that the la.d is expressed in meters.</p>
<p>What is missing here? Do you remember the intra-zone commuting flows? E.g. the commuters that live and work in Bristol? We had removed these from the network analysis and visualisation element. Because we don’t have information about the distances of the intra-zone commutes, we will exclude them from this analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>la.d <span class="ot">&lt;-</span> la.d <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Var1 <span class="sc">!=</span> Var2) <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 119,370
Columns: 3
$ Var1  &lt;fct&gt; E41000002, E41000003, E41000004, E41000005, E41000006, E41000007~
$ Var2  &lt;fct&gt; E41000001, E41000001, E41000001, E41000001, E41000001, E41000001~
$ value &lt;dbl&gt; 14370.86, 20185.71, 11427.54, 23175.73, 175329.74, 164912.66, 13~</code></pre>
</div>
</div>
<p>What we want to do is to match the data frame with all the distances with the commuting flows data frame. To do that we will (1) create a new data frame for the origin-destination pair and (2) match the two data frames.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>la.d <span class="ot">&lt;-</span> la.d <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ij.code =</span> <span class="fu">paste</span>(Var1, Var2, <span class="at">sep =</span> <span class="st">"_"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 119,370
Columns: 4
$ Var1    &lt;fct&gt; E41000002, E41000003, E41000004, E41000005, E41000006, E410000~
$ Var2    &lt;fct&gt; E41000001, E41000001, E41000001, E41000001, E41000001, E410000~
$ value   &lt;dbl&gt; 14370.86, 20185.71, 11427.54, 23175.73, 175329.74, 164912.66, ~
$ ij.code &lt;chr&gt; "E41000002_E41000001", "E41000003_E41000001", "E41000004_E4100~</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>commuting <span class="ot">&lt;-</span> commuting <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ij.code =</span> <span class="fu">paste</span>(<span class="st">`</span><span class="at">Area of usual residence</span><span class="st">`</span>,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>                          <span class="st">`</span><span class="at">Area of workplace</span><span class="st">`</span>,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sep =</span> <span class="st">"_"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 92,688
Columns: 15
$ `Area of usual residence`                  &lt;chr&gt; "E41000001", "E41000001", "~
$ `Area of workplace`                        &lt;chr&gt; "E41000002", "E41000003", "~
$ `All categories: Method of travel to work` &lt;dbl&gt; 1591, 534, 3865, 433, 5, 2,~
$ `Work mainly at or from home`              &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, ~
$ `Underground, metro, light rail, tram`     &lt;dbl&gt; 1, 0, 1, 0, 0, 0, 0, 0, 0, ~
$ Train                                      &lt;dbl&gt; 32, 0, 49, 11, 0, 0, 0, 0, ~
$ `Bus, minibus or coach`                    &lt;dbl&gt; 140, 21, 167, 7, 0, 0, 0, 1~
$ Taxi                                       &lt;dbl&gt; 11, 4, 20, 1, 0, 0, 0, 0, 0~
$ `Motorcycle, scooter or moped`             &lt;dbl&gt; 6, 6, 23, 4, 0, 0, 0, 0, 0,~
$ `Driving a car or van`                     &lt;dbl&gt; 1225, 448, 3144, 360, 5, 2,~
$ `Passenger in a car or van`                &lt;dbl&gt; 99, 36, 365, 33, 0, 0, 0, 0~
$ Bicycle                                    &lt;dbl&gt; 13, 1, 29, 2, 0, 0, 0, 0, 0~
$ `On foot`                                  &lt;dbl&gt; 60, 16, 60, 15, 0, 0, 0, 0,~
$ `Other method of travel to work`           &lt;dbl&gt; 4, 2, 7, 0, 0, 0, 0, 0, 0, ~
$ ij.code                                    &lt;chr&gt; "E41000001_E41000002", "E41~</code></pre>
</div>
</div>
<p>Before we perform the match, keep a note of how many observations both data frames have in order to check if we loose any observations during the matching. As you can see the commuting data frame has less observations than the la.d one, which includes all the possible origin-destination pairs.</p>
<p>What does it mean? That for some origin-destination pairs there are no commuting flows, which of course makes sense. We need to include these pairs with <span class="math inline">\(flow = 0\)</span> in our data though because the lack of commuting flows <strong>is not</strong> missing data!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>commuting.si <span class="ot">&lt;-</span> <span class="fu">full_join</span>(la.d, commuting, <span class="at">by =</span> <span class="st">"ij.code"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 119,370
Columns: 18
$ Var1                                       &lt;fct&gt; E41000002, E41000003, E4100~
$ Var2                                       &lt;fct&gt; E41000001, E41000001, E4100~
$ value                                      &lt;dbl&gt; 14370.86, 20185.71, 11427.5~
$ ij.code                                    &lt;chr&gt; "E41000002_E41000001", "E41~
$ `Area of usual residence`                  &lt;chr&gt; "E41000002", "E41000003", "~
$ `Area of workplace`                        &lt;chr&gt; "E41000001", "E41000001", "~
$ `All categories: Method of travel to work` &lt;dbl&gt; 990, 558, 2590, 266, 1, 4, ~
$ `Work mainly at or from home`              &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, NA, 0,~
$ `Underground, metro, light rail, tram`     &lt;dbl&gt; 0, 1, 0, 0, 0, 0, 0, NA, 0,~
$ Train                                      &lt;dbl&gt; 6, 3, 25, 2, 0, 0, 0, NA, 1~
$ `Bus, minibus or coach`                    &lt;dbl&gt; 58, 8, 87, 6, 0, 0, 0, NA, ~
$ Taxi                                       &lt;dbl&gt; 1, 2, 4, 0, 0, 0, 0, NA, 0,~
$ `Motorcycle, scooter or moped`             &lt;dbl&gt; 2, 1, 12, 0, 0, 0, 0, NA, 0~
$ `Driving a car or van`                     &lt;dbl&gt; 783, 499, 2259, 244, 1, 4, ~
$ `Passenger in a car or van`                &lt;dbl&gt; 73, 26, 154, 10, 0, 0, 0, N~
$ Bicycle                                    &lt;dbl&gt; 15, 9, 23, 0, 0, 0, 0, NA, ~
$ `On foot`                                  &lt;dbl&gt; 52, 8, 24, 4, 0, 0, 0, NA, ~
$ `Other method of travel to work`           &lt;dbl&gt; 0, 1, 2, 0, 0, 0, 0, NA, 0,~</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Some variables are repetitive or need name change</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>commuting.si <span class="ot">&lt;-</span> commuting.si <span class="sc">%&gt;%</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">i =</span> Var1,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">j =</span> Var2,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">distance =</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">Area of usual residence</span><span class="st">`</span>,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span><span class="st">`</span><span class="at">Area of workplace</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 119,370
Columns: 16
$ i                                          &lt;fct&gt; E41000002, E41000003, E4100~
$ j                                          &lt;fct&gt; E41000001, E41000001, E4100~
$ distance                                   &lt;dbl&gt; 14370.86, 20185.71, 11427.5~
$ ij.code                                    &lt;chr&gt; "E41000002_E41000001", "E41~
$ `All categories: Method of travel to work` &lt;dbl&gt; 990, 558, 2590, 266, 1, 4, ~
$ `Work mainly at or from home`              &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, NA, 0,~
$ `Underground, metro, light rail, tram`     &lt;dbl&gt; 0, 1, 0, 0, 0, 0, 0, NA, 0,~
$ Train                                      &lt;dbl&gt; 6, 3, 25, 2, 0, 0, 0, NA, 1~
$ `Bus, minibus or coach`                    &lt;dbl&gt; 58, 8, 87, 6, 0, 0, 0, NA, ~
$ Taxi                                       &lt;dbl&gt; 1, 2, 4, 0, 0, 0, 0, NA, 0,~
$ `Motorcycle, scooter or moped`             &lt;dbl&gt; 2, 1, 12, 0, 0, 0, 0, NA, 0~
$ `Driving a car or van`                     &lt;dbl&gt; 783, 499, 2259, 244, 1, 4, ~
$ `Passenger in a car or van`                &lt;dbl&gt; 73, 26, 154, 10, 0, 0, 0, N~
$ Bicycle                                    &lt;dbl&gt; 15, 9, 23, 0, 0, 0, 0, NA, ~
$ `On foot`                                  &lt;dbl&gt; 52, 8, 24, 4, 0, 0, 0, NA, ~
$ `Other method of travel to work`           &lt;dbl&gt; 0, 1, 2, 0, 0, 0, 0, NA, 0,~</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's see if we have any missing values</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(commuting.si, <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                       i 
                                       0 
                                       j 
                                       0 
                                distance 
                                       0 
                                 ij.code 
                                       0 
All categories: Method of travel to work 
                                   26682 
             Work mainly at or from home 
                                   26682 
    Underground, metro, light rail, tram 
                                   26682 
                                   Train 
                                   26682 
                   Bus, minibus or coach 
                                   26682 
                                    Taxi 
                                   26682 
            Motorcycle, scooter or moped 
                                   26682 
                    Driving a car or van 
                                   26682 
               Passenger in a car or van 
                                   26682 
                                 Bicycle 
                                   26682 
                                 On foot 
                                   26682 
          Other method of travel to work 
                                   26682 </code></pre>
</div>
</div>
<p>There are quite a few. What does it mean? That there are no commuting flows for these origin-destination pairs and,therefore, were excluded from the origin commuting data set we downloaded. So, we are going to replace these <span class="math inline">\(NAs\)</span> with <span class="math inline">\(0s\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>commuting.si <span class="ot">&lt;-</span> commuting.si <span class="sc">%&gt;%</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace</span>(., <span class="fu">is.na</span>(.), <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let’s bring data for some <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> characteristics that we believe that affect commuting. I have prepared such a small data set from the census, which includes resident population and working populations as <em>push</em> and <em>pull</em> variables. These data have been obtained by <a href="https://www.nomisweb.co.uk/published/census/odexplorer.asp">nomis</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>data.workplace <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://www.dropbox.com/s/0ym88p8quwaiyau/data_workplace.csv?dl=1"</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Dropbox trick: to use in an .Rmd the link that Dropbox provides to share a file</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># replace dl=0 with dl=1 at the end of the link</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>data.resident <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://www.dropbox.com/s/09d7v5cm6ov3ioz/data_resident.csv?dl=1"</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>commuting.si <span class="ot">&lt;-</span> commuting.si <span class="sc">%&gt;%</span> </span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(data.resident, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'i'</span> <span class="ot">=</span> <span class="st">'Merging.Local.Authority.Code'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(data.workplace, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'j'</span> <span class="ot">=</span> <span class="st">'Merging.Local.Authority.Code'</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" type="alert alert-warning">
<div class="alert alert-warning">
<p>
<strong>Question</strong> are there any redundant columns? Can you remove them?
</p>
</div>
</div>
<p>Before we start modelling these flows, let’s plot our variables.</p>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(commuting.si, <span class="fu">aes</span>(<span class="at">x=</span>distance,</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y=</span><span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sim_files/figure-html/si.plots-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(commuting.si, <span class="fu">aes</span>(<span class="at">x=</span>resident,</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y=</span><span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sim_files/figure-html/si.plots-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(commuting.si, <span class="fu">aes</span>(<span class="at">x=</span>workplace,</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y=</span><span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sim_files/figure-html/si.plots-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell" type="alert alert-warning">
<div class="alert alert-warning">
<p>
<strong>Question</strong> What do you take from these graphs?
</p>
</div>
</div>
<p>Let’s try now to model these flows. We will start with a simple OLS to estimate the above specifications. Please pay attention to the small trick we did. Because there are non-materialised origin-destination pairs (i.e.&nbsp;with 0 flows), we added a small value (<span class="math inline">\(0.5\)</span>) in the dependent variable. Otherwise we will receive an error as the logarithm of <span class="math inline">\(0\)</span> is not defined.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>ols.model <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(<span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span><span class="sc">+</span>.<span class="dv">5</span>) <span class="sc">~</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">log</span>(distance) <span class="sc">+</span> <span class="fu">log</span>(resident) <span class="sc">+</span> <span class="fu">log</span>(workplace),</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> commuting.si)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co"># To see the model output you can use the summary() function.</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ols.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(`All categories: Method of travel to work` + 
    0.5) ~ log(distance) + log(resident) + log(workplace), data = commuting.si)

Residuals:
    Min      1Q  Median      3Q     Max 
-4.2623 -0.7149 -0.0430  0.6429  8.6146 

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)     7.961526   0.106137   75.01   &lt;2e-16 ***
log(distance)  -1.839355   0.004611 -398.87   &lt;2e-16 ***
log(resident)   0.514276   0.005403   95.19   &lt;2e-16 ***
log(workplace)  0.852536   0.005186  164.38   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.104 on 115932 degrees of freedom
  (4816 observations deleted due to missingness)
Multiple R-squared:  0.6442,    Adjusted R-squared:  0.6442 
F-statistic: 6.997e+04 on 3 and 115932 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>So, the OLS regression estimated the four parameters:</p>
<ul>
<li><span class="math inline">\(lnk = 7.971\)</span></li>
<li><span class="math inline">\(\beta = -1.840\)</span></li>
<li><span class="math inline">\(\lambda = 0.514\)</span></li>
<li><span class="math inline">\(\alpha = -0.852\)</span></li>
</ul>
<p>Let’s estimate now our model using a Poisson regression. Given that we don’t take the logarithm of the dependent variable, there is no need to add <span class="math inline">\(0.5\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>glm.model <span class="ot">&lt;-</span> <span class="fu">glm</span>((<span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span>)<span class="sc">~</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">log</span>(distance) <span class="sc">+</span> <span class="fu">log</span>(resident) <span class="sc">+</span> <span class="fu">log</span>(workplace),</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>), <span class="at">data =</span> commuting.si)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = (`All categories: Method of travel to work`) ~ 
    log(distance) + log(resident) + log(workplace), family = poisson(link = "log"), 
    data = commuting.si)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-343.27    -4.94    -3.17    -1.82   346.33  

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)    11.6302968  0.0091305  1273.8   &lt;2e-16 ***
log(distance)  -1.8155761  0.0002800 -6483.1   &lt;2e-16 ***
log(resident)   0.3189626  0.0005445   585.8   &lt;2e-16 ***
log(workplace)  0.8202729  0.0004197  1954.4   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 71855219  on 115935  degrees of freedom
Residual deviance: 14140526  on 115932  degrees of freedom
  (4816 observations deleted due to missingness)
AIC: 14483130

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
<p>The following parameter1 have been estimated</p>
<ul>
<li><span class="math inline">\(lnk = 11.635\)</span></li>
<li><span class="math inline">\(\beta = -1.816\)</span></li>
<li><span class="math inline">\(\lambda = 0.319\)</span></li>
<li><span class="math inline">\(\alpha = 0.820\)</span></li>
</ul>
<p>As you can see the differences are rather small.</p>
<p>The <code>stargazer</code> package I use below creates elegant regression tables. Replace <code>type = "html"</code> with <code>type = "text"</code> to have be able to read the results using the .Rmd document. the “html” option is useful for when knitting the script to an .html document.</p>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(ols.model, glm.model, <span class="at">type =</span> <span class="st">"html"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<table style="text-align:center">
<tbody><tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td colspan="2">
<em>Dependent variable:</em>
</td>
</tr>
<tr>
<td>
</td>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
log(<code>All categories: Method of travel to work</code> + 0.5)
</td>
<td>
(<code>All categories: Method of travel to work</code>)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
<em>OLS</em>
</td>
<td>
<em>Poisson</em>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(1)
</td>
<td>
(2)
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
log(distance)
</td>
<td>
-1.839<sup>***</sup>
</td>
<td>
-1.816<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.005)
</td>
<td>
(0.0003)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
log(resident)
</td>
<td>
0.514<sup>***</sup>
</td>
<td>
0.319<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.005)
</td>
<td>
(0.001)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
log(workplace)
</td>
<td>
0.853<sup>***</sup>
</td>
<td>
0.820<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.005)
</td>
<td>
(0.0004)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Constant
</td>
<td>
7.962<sup>***</sup>
</td>
<td>
11.630<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.106)
</td>
<td>
(0.009)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Observations
</td>
<td>
115,936
</td>
<td>
115,936
</td>
</tr>
<tr>
<td style="text-align:left">
R<sup>2</sup>
</td>
<td>
0.644
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Adjusted R<sup>2</sup>
</td>
<td>
0.644
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Log Likelihood
</td>
<td>
</td>
<td>
-7,241,561.000
</td>
</tr>
<tr>
<td style="text-align:left">
Akaike Inf. Crit.
</td>
<td>
</td>
<td>
14,483,130.000
</td>
</tr>
<tr>
<td style="text-align:left">
Residual Std. Error
</td>
<td>
1.104 (df = 115932)
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
F Statistic
</td>
<td>
69,973.050<sup>***</sup> (df = 3; 115932)
</td>
<td>
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
<em>Note:</em>
</td>
<td colspan="2" style="text-align:right">
<sup><em></em></sup><em>p&lt;0.1; <sup><strong></strong></sup><strong>p&lt;0.05; <sup></sup></strong></em>p&lt;0.01
</td>
</tr>

</tbody></table>
<div class="cell" type="alert alert-warning">
<div class="alert alert-warning">
<p>
<strong>Question</strong> Can you interpret the regression results?
</p>
</div>
</div>
</section>
<section id="this-is-not-a-machine-learning-introduction" class="level2">
<h2 class="anchored" data-anchor-id="this-is-not-a-machine-learning-introduction">This is not a Machine Learning introduction…</h2>
<p>… but maybe a sneak preview of the philosophy behind <em>modern</em> data science approaches to answer computational problems. We are using the <code>caret</code> package to:</p>
<ul>
<li><p>split our data into test and training</p></li>
<li><p>train a <code>lm()</code>and a <code>glm()</code> model using the training data set</p></li>
<li><p>use the estimated models to make <em>out-of-sample</em> predictions using the test data set</p></li>
<li><p>plot the results and the relevant metrics and choose the best model.</p></li>
</ul>
<p>This is obviously an oversimplification, but it provides a good preview of machine learning frameworks.</p>
<p>It is worth browsing the <a href="https://topepo.github.io/caret/"><code>caret</code></a> package.</p>
<p><strong>The below will take a few minutes!</strong></p>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>commuting.si <span class="ot">&lt;-</span> commuting.si <span class="sc">%&gt;%</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Rows: 115,936 Columns: 22 $ i <chr> “E41000002”, “E41000003”, “~ $ j <chr>”E41000001”, “E41000001”, “~ $ distance <dbl> 14370.86, 20185.71, 11427.5~ $ ij.code <chr>”E41000002_E41000001”, “E41~ $ <code>All categories: Method of travel to work</code> <dbl> 990, 558, 2590, 1, 4, 2, 0,~ $ <code>Work mainly at or from home</code> <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, ~ $ <code>Underground, metro, light rail, tram</code> <dbl> 0, 1, 0, 0, 0, 0, 0, 0, 0, ~ $ Train <dbl> 6, 3, 25, 0, 0, 0, 0, 1, 0,~ $ <code>Bus, minibus or coach</code> <dbl> 58, 8, 87, 0, 0, 0, 0, 1, 2~ $ Taxi <dbl> 1, 2, 4, 0, 0, 0, 0, 0, 0, ~ $ <code>Motorcycle, scooter or moped</code> <dbl> 2, 1, 12, 0, 0, 0, 0, 0, 0,~ $ <code>Driving a car or van</code> <dbl> 783, 499, 2259, 1, 4, 2, 0,~ $ <code>Passenger in a car or van</code> <dbl> 73, 26, 154, 0, 0, 0, 0, 0,~ $ Bicycle <dbl> 15, 9, 23, 0, 0, 0, 0, 0, 0~ $ <code>On foot</code> <dbl> 52, 8, 24, 0, 0, 0, 0, 0, 0~ $ <code>Other method of travel to work</code> <dbl> 0, 1, 2, 0, 0, 0, 0, 0, 0, ~ $ la.code.st.x <chr>”E06000002”, “E06000003”, “~ $ la.names.x <chr>”Middlesbrough”, “Redcar an~ $ resident <int> 138412, 135177, 191610, 125~ $ la.code.st.y <chr>”E06000001”, “E06000001”, “~ $ la.names.y <chr>”Hartlepool”, “Hartlepool”,~ $ workplace <int> 34197, 34197, 34197, 34197,~</int></chr></chr></int></chr></chr></dbl></dbl></dbl></dbl></dbl></dbl></dbl></dbl></dbl></dbl></dbl></dbl></chr></dbl></chr></chr></p>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">3456</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>trainIndex <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(commuting.si<span class="sc">$</span><span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span>, <span class="at">p =</span> .<span class="dv">8</span>, </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">list =</span> <span class="cn">FALSE</span>, </span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">times =</span> <span class="dv">1</span>)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(trainIndex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>[1] 92751 1</p>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(commuting.si)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>[1] 115936 22</p>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>commuting.si.train <span class="ot">&lt;-</span> commuting.si[ trainIndex,]</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>commuting.si.test  <span class="ot">&lt;-</span> commuting.si[<span class="sc">-</span>trainIndex,]</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>model.lm <span class="ot">&lt;-</span> <span class="fu">train</span>(<span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span> <span class="sc">~</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>                    distance <span class="sc">+</span> resident <span class="sc">+</span> workplace,</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> commuting.si,</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method =</span> <span class="st">"lm"</span>)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>predictions.lm <span class="ot">&lt;-</span> <span class="fu">predict</span>(model.lm, commuting.si.test)</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>lm.metrics <span class="ot">&lt;-</span> <span class="fu">postResample</span>(<span class="at">pred =</span> predictions.lm, <span class="at">obs =</span> commuting.si.test<span class="sc">$</span><span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span>) </span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>model.glm <span class="ot">&lt;-</span> <span class="fu">train</span>(<span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span> <span class="sc">~</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>                    distance <span class="sc">+</span> resident <span class="sc">+</span> workplace,</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> commuting.si,</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method =</span> <span class="st">"glmnet"</span>,</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family =</span> <span class="st">"poisson"</span>, </span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>                    <span class="at">na.action =</span> na.omit)</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>predictions.glm <span class="ot">&lt;-</span> <span class="fu">predict</span>(model.glm, commuting.si.test)</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>glm.metrics <span class="ot">&lt;-</span> <span class="fu">postResample</span>(<span class="at">pred =</span> predictions.glm, <span class="at">obs =</span> commuting.si.test<span class="sc">$</span><span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span>) </span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(lm.metrics, glm.metrics) <span class="sc">%&gt;%</span> </span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="fu">c</span>(<span class="st">"lm"</span>, <span class="st">"glm"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Model, Rsquared, RMSE, MAE) <span class="sc">%&gt;%</span> </span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table>
 <thead>
  <tr>
   <th style="text-align:left;"> Model </th>
   <th style="text-align:right;"> Rsquared </th>
   <th style="text-align:right;"> RMSE </th>
   <th style="text-align:right;"> MAE </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> lm </td>
   <td style="text-align:right;"> 0.067 </td>
   <td style="text-align:right;"> 824.062 </td>
   <td style="text-align:right;"> 214.027 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> glm </td>
   <td style="text-align:right;"> 0.423 </td>
   <td style="text-align:right;"> 687.778 </td>
   <td style="text-align:right;"> 112.517 </td>
  </tr>
</tbody>
</table>

</div>
<div class="cell" type="alert alert-warning">
<div class="alert alert-warning">
<p>
<strong>Question</strong> Which model would you choose?
</p>
</div>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>predict.lm.plot <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(commuting.si.test<span class="sc">$</span><span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span>, predictions.lm) <span class="sc">%&gt;%</span> </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">y =</span> <span class="st">'...1'</span>,</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">y_hat =</span> <span class="st">'...2'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>y, <span class="at">y=</span>y_hat)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"lm"</span>) <span class="sc">+</span> </span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>predict.glm.plot <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(commuting.si.test<span class="sc">$</span><span class="st">`</span><span class="at">All categories: Method of travel to work</span><span class="st">`</span>, predictions.glm) <span class="sc">%&gt;%</span> </span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">y =</span> <span class="st">'...1'</span>,</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">y_hat =</span> <span class="st">'...2'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>y, <span class="at">y=</span>y_hat)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"glm"</span>) <span class="sc">+</span> </span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>predict.lm.plot <span class="sc">+</span> predict.glm.plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sim_files/figure-html/predict.plots-1.png" class="img-fluid" width="672"></p>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>