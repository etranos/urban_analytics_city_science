<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Emmanouil Tranos">
<meta name="dcterms.date" content="2023-09-22">

<title>Urban analytics and city science - Practical 1: APIs and urban data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../src/apis.html">Practicals</a></li><li class="breadcrumb-item"><a href="../src/apis.html">Practical 1: APIs and urban data</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Urban analytics and city science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/etranos/urban_analytics_city_science" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Content</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/description.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Unit description and aims</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/readings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Key readings</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/project.md" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assessment</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Lectures</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/why_cities.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cities, a very very brief introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/smart_cities.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Smart cities, urban big data, digital twins and other buzz terms</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/intro_networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Networks: an introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/network_science.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Network science, urban laws and scaling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/transport_geography.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Methods in transport geography</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/diversity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Diversity in cities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/Urban_policy___causal_design.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Urban policies and causality</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Practicals</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/apis.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Practical 1: APIs and urban data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/network_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Network analysis practical: networks of cities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/street_networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Street network analysis practical: networks within cities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/network_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Network models in practice</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/sim.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spatial interaction modelling</span></a>
  </div>
</li>
          <li class="sidebar-item">
 <span class="menu-text">src/accessibility_full.Rmd</span>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../src/causality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Causal design and urban policy evaluation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Unit leader</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://etranos.info/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Professor Emmanouil Tranos</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#aims-of-the-practical" id="toc-aims-of-the-practical" class="nav-link active" data-scroll-target="#aims-of-the-practical">Aims of the practical</a></li>
  <li><a href="#apis" id="toc-apis" class="nav-link" data-scroll-target="#apis">APIs</a></li>
  <li><a href="#json-file-format" id="toc-json-file-format" class="nav-link" data-scroll-target="#json-file-format">JSON file format</a></li>
  <li><a href="#practical-example-with-api" id="toc-practical-example-with-api" class="nav-link" data-scroll-target="#practical-example-with-api">Practical example with API</a></li>
  <li><a href="#accessing-apis-using-existing-r-packages" id="toc-accessing-apis-using-existing-r-packages" class="nav-link" data-scroll-target="#accessing-apis-using-existing-r-packages">Accessing APIs using existing <code>R</code> packages</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Practical 1: APIs and urban data</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Emmanouil Tranos </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 22, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="aims-of-the-practical" class="level2">
<h2 class="anchored" data-anchor-id="aims-of-the-practical">Aims of the practical</h2>
<ul>
<li><p>Understand the technicalities and the breadth of the urban data landscape</p></li>
<li><p>Understand the <em>messiness</em> of real world (urban) data</p></li>
<li><p>Access programmatically urban data and understand the benefits of such data access practise.</p></li>
</ul>
</section>
<section id="apis" class="level2">
<h2 class="anchored" data-anchor-id="apis">APIs</h2>
<p>Application Programming Interface (APIs) represent a ‚Äògate‚Äô or otherwise a platform that enables a client (that is you) to interact with a server (for example <a href="https://opendata.bristol.gov.uk/">opendata.bristol.gov.uk</a>). According to <span class="citation" data-cites="amazonWhatAPI">AWS (<a href="#ref-amazonWhatAPI" role="doc-biblioref">2022</a>)</span>:</p>
<blockquote class="blockquote">
<p>In the context of APIs, the word Application refers to any software with a distinct function. Interface can be thought of as a contract of service between two applications. This contract defines how the two communicate with each other using requests and responses. Their API documentation contains information on how developers are to structure those requests and responses.</p>
</blockquote>
<p>The client‚Äôs software (this might be R for example) sends a request to the server requesting specific data. The response is the data the client asked.</p>
<p>More commonly, the client might be a mobile phone app (e.g.&nbsp;train network status app) and the server is the network operator‚Äôs server.</p>
<p>APIs can be private or public types. For more inthe description from <span class="citation" data-cites="amazonWhatAPI">AWS (<a href="#ref-amazonWhatAPI" role="doc-biblioref">2022</a>)</span> <a href="https://aws.amazon.com/what-is/api/#:~:text=API%20stands%20for%20Application%20Programming,other%20using%20requests%20and%20responses.">here</a></p>
</section>
<section id="json-file-format" class="level2">
<h2 class="anchored" data-anchor-id="json-file-format">JSON file format</h2>
<p>Although some urban data can be downloaded as a tidy<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> table in a <code>.csv</code> format, most APIs will ship data to you in a <code>JSON</code> format.</p>
<p>According to the official JSON website <span class="citation" data-cites="jsonJSON">(<a href="#ref-jsonJSON" role="doc-biblioref">JSON</a>)</span>, JSON</p>
<blockquote class="blockquote">
<p>is a lightweight data-interchange format. It is easy for humans to read and write. It is easy for machines to parse and generate. It is based on a subset of the JavaScript Programming Language Standard ECMA-262 3rd Edition - December 1999. JSON is a text format that is completely language independent but uses conventions that are familiar to programmers of the C-family of languages, including C, C++, C#, Java, JavaScript, Perl, Python, and many others. These properties make JSON an ideal data-interchange language.</p>
</blockquote>
<p>It adopts a hierarchical structure such as <code>attribute:value</code> instead of the fixed structure of tidy data. Following <span class="citation" data-cites="singleton2017urban">Singleton, Spielman, and Folch (<a href="#ref-singleton2017urban" role="doc-biblioref">2017</a>)</span>, such <code>attribute:value</code> pairs might be:</p>
<ul>
<li><p>‚Äúmean income‚Äù:‚Äú50000‚Äù</p></li>
<li><p>‚Äúinternet speed‚Äù:‚Äú35‚Äù</p></li>
<li><p>‚Äújobs‚Äù:‚Äú15000‚Äù</p></li>
</ul>
<p>These attributes might be organised hierarchically:</p>
<p>(‚Äúcity‚Äù:‚ÄúBristol,‚Äùmean income‚Äù: ‚Äú27000‚Äù, ‚Äúinternet speed‚Äù: ‚Äú55‚Äù, ‚Äújobs‚Äù:(‚Äú2019‚Äù:‚Äú15000‚Äù, ‚Äú2020‚Äù:‚Äú14000‚Äù)), (‚Äúcity‚Äù:‚ÄúNewcastle,‚Äùmean income‚Äù: ‚Äú25000‚Äù, ‚Äúinternet speed‚Äù: ‚Äú45‚Äù, ‚Äújobs‚Äù:(‚Äú2019‚Äù:‚Äú11000‚Äù, ‚Äú2020‚Äù:‚Äú10000‚Äù))</p>
<p>Although this format is more verbose (attribute names are repeated) it is more flexible (not all observations need to have all attributes) <span class="citation" data-cites="singleton2017urban">(<a href="#ref-singleton2017urban" role="doc-biblioref">Singleton, Spielman, and Folch 2017</a>)</span></p>
</section>
<section id="practical-example-with-api" class="level2">
<h2 class="anchored" data-anchor-id="practical-example-with-api">Practical example with API</h2>
<p><a href="https://opendata.bristol.gov.uk/pages/homepage/">opendata.bristol.gov.uk</a> offers a lot of data about Bristol. For this example, let‚Äôs try to work with <a href="https://opendata.bristol.gov.uk/datasets/bcc::jobs-by-ward-by-industry-in-bristol-2020/explore?location=51.470876%2C-2.616185%2C12.13">Jobs by Ward (by industry) in Bristol 2020</a>. As you can see, this is a small data set with <span class="math inline">\(34\)</span> observations representing Bristol‚Äôs <span class="math inline">\(34\)</span> Wards. You can visualise these data with the <code>Table</code> tab on the right hand-side and even download a <code>.csv</code> with these data. To begin with, do both of these things.</p>
<p>Then, go to the <code>More Info</code> icon, scroll down on the left hand side and click on <code>I want to use this</code>. You can find the relevant link under <code>View API Resources</code>. We are interested in the <code>GeoJSON</code>. You can view the data in this format and also copy the links to access these data <em>programmatically</em>. The <em>weird</em> output on your screen is the data you requested in <code>JSON</code> format. If you carefully read the URL from right to left you can see some logic on how this URL is built.</p>
<div class="cell" type="alert alert-warning">
<div class="alert alert-warning">
<p>
<strong>Question</strong>: Why should you go through all these efforts to build an API request and download the data in <code>JSON</code> file format instead of just downloading a <code>.csv</code> file?
</p>
</div>
</div>
<p>So, let‚Äôs try to access these data programmatically. First, we need to load the relevant <code>R</code> packages</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To access the data, we are going to use the function <code>fromJSON()</code> from the <code>jsonlite</code> package. Please check the syntax of this function as well as the other function of this package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(<span class="st">"https://services2.arcgis.com/a4vR8lmmksFixzmB/ArcGIS/rest/services/Jobs_by_Ward_(by_industry)_in_Bristol_2020/FeatureServer/0/query?outFields=*&amp;where=1%3D1&amp;f=geojson"</span>, <span class="at">flatten =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now have an <code>R</code> object called <code>dat</code>. Let‚Äôs try to see how it looks like</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "list"</code></pre>
</div>
</div>
<p>So, this is a list. If you need a reminder for what a list is, see <a href="http://adv-r.had.co.nz/Data-structures.html">here</a>. Now the difficult part. Let‚Äôs try to figure out the structure of this <code>JSON</code> formatted data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ type    : chr "FeatureCollection"
 $ features:'data.frame':   34 obs. of  28 variables:
  ..$ type                                      : chr [1:34] "Feature" "Feature" "Feature" "Feature" ...
  ..$ id                                        : int [1:34] 1 2 3 4 5 6 7 8 9 10 ...
  ..$ geometry.type                             : chr [1:34] "Polygon" "Polygon" "Polygon" "Polygon" ...
  ..$ geometry.coordinates                      :List of 34
  .. ..$ : num [1, 1:7825, 1:2] -2.67 -2.67 -2.67 -2.67 -2.67 ...
  .. ..$ : num [1, 1:2140, 1:2] -2.58 -2.58 -2.58 -2.59 -2.59 ...
  .. ..$ : num [1, 1:1447, 1:2] -2.6 -2.6 -2.6 -2.6 -2.6 ...
  .. ..$ : num [1, 1:874, 1:2] -2.58 -2.58 -2.58 -2.58 -2.58 ...
  .. ..$ : num [1, 1:1480, 1:2] -2.56 -2.56 -2.56 -2.56 -2.56 ...
  .. ..$ : num [1, 1:1320, 1:2] -2.53 -2.53 -2.53 -2.52 -2.52 ...
  .. ..$ : num [1, 1:1032, 1:2] -2.51 -2.51 -2.51 -2.51 -2.51 ...
  .. ..$ : num [1, 1:1337, 1:2] -2.51 -2.51 -2.51 -2.51 -2.51 ...
  .. ..$ : num [1, 1:1729, 1:2] -2.52 -2.52 -2.52 -2.52 -2.52 ...
  .. ..$ : num [1, 1:2372, 1:2] -2.53 -2.53 -2.53 -2.53 -2.53 ...
  .. ..$ : num [1, 1:2257, 1:2] -2.56 -2.56 -2.56 -2.56 -2.56 ...
  .. ..$ : num [1, 1:1462, 1:2] -2.53 -2.53 -2.53 -2.53 -2.53 ...
  .. ..$ : num [1, 1:2277, 1:2] -2.56 -2.56 -2.56 -2.56 -2.56 ...
  .. ..$ : num [1, 1:2073, 1:2] -2.62 -2.62 -2.62 -2.62 -2.62 ...
  .. ..$ : num [1, 1:1301, 1:2] -2.63 -2.63 -2.63 -2.63 -2.63 ...
  .. ..$ : num [1, 1:1327, 1:2] -2.63 -2.63 -2.63 -2.63 -2.63 ...
  .. ..$ : num [1, 1:783, 1:2] -2.61 -2.61 -2.62 -2.62 -2.62 ...
  .. ..$ : num [1, 1:897, 1:2] -2.6 -2.6 -2.6 -2.6 -2.6 ...
  .. ..$ : num [1, 1:807, 1:2] -2.58 -2.58 -2.58 -2.58 -2.58 ...
  .. ..$ : num [1, 1:811, 1:2] -2.58 -2.58 -2.58 -2.58 -2.58 ...
  .. ..$ : num [1, 1:893, 1:2] -2.62 -2.62 -2.62 -2.62 -2.62 ...
  .. ..$ : num [1, 1:551, 1:2] -2.61 -2.61 -2.61 -2.61 -2.61 ...
  .. ..$ : num [1, 1:498, 1:2] -2.6 -2.6 -2.6 -2.6 -2.6 ...
  .. ..$ : num [1, 1:731, 1:2] -2.59 -2.59 -2.59 -2.59 -2.59 ...
  .. ..$ : num [1, 1:1149, 1:2] -2.56 -2.56 -2.56 -2.56 -2.56 ...
  .. ..$ : num [1, 1:971, 1:2] -2.56 -2.56 -2.56 -2.56 -2.56 ...
  .. ..$ : num [1, 1:748, 1:2] -2.55 -2.55 -2.55 -2.55 -2.55 ...
  .. ..$ : num [1, 1:1429, 1:2] -2.55 -2.55 -2.55 -2.55 -2.55 ...
  .. ..$ : num [1, 1:732, 1:2] -2.58 -2.58 -2.58 -2.58 -2.58 ...
  .. ..$ : num [1, 1:2684, 1:2] -2.62 -2.62 -2.62 -2.62 -2.62 ...
  .. ..$ : num [1, 1:1265, 1:2] -2.62 -2.62 -2.62 -2.62 -2.62 ...
  .. ..$ : num [1, 1:733, 1:2] -2.61 -2.61 -2.61 -2.61 -2.61 ...
  .. ..$ : num [1, 1:664, 1:2] -2.58 -2.58 -2.58 -2.58 -2.58 ...
  .. ..$ : num [1, 1:846, 1:2] -2.57 -2.57 -2.57 -2.57 -2.57 ...
  ..$ properties.OBJECTID                       : int [1:34] 1 2 3 4 5 6 7 8 9 10 ...
  ..$ properties.Ward_code_1                    : chr [1:34] "E05010886" "E05010901" "E05010913" "E05010904" ...
  ..$ properties.Ward                           : chr [1:34] "Avonmouth and Lawrence Weston" "Henbury and Brentry" "Southmead" "Horfield" ...
  ..$ properties.Period                         : int [1:34] 2020 2020 2020 2020 2020 2020 2020 2020 2020 2020 ...
  ..$ properties.Agriculture_forestry_fishing   : int [1:34] 10 0 0 0 0 0 0 0 0 0 ...
  ..$ properties.Mining_quarrying_utilities     : int [1:34] 700 0 0 0 150 0 0 0 0 0 ...
  ..$ properties.Manufacturing                  : int [1:34] 1500 50 10 100 35 50 600 40 35 900 ...
  ..$ properties.Construction                   : int [1:34] 1500 45 50 50 50 125 200 125 150 500 ...
  ..$ properties.Motor_trades                   : int [1:34] 1000 15 25 10 50 40 35 50 75 300 ...
  ..$ properties.Wholesale                      : int [1:34] 4000 100 10 10 100 20 250 50 0 450 ...
  ..$ properties.Retail                         : int [1:34] 1000 150 150 125 1000 500 75 125 50 200 ...
  ..$ properties.Transport_storage__inc_postal_ : int [1:34] 5000 75 35 20 50 300 45 20 25 350 ...
  ..$ properties.Accommodation_food_services    : int [1:34] 250 100 50 150 100 300 75 100 35 175 ...
  ..$ properties.Information_communication      : int [1:34] 175 50 100 150 125 50 150 100 20 400 ...
  ..$ properties.Financial_and_insurance        : int [1:34] 15 0 10 0 0 35 10 0 0 10 ...
  ..$ properties.Property                       : int [1:34] 125 15 10 50 100 30 40 15 10 20 ...
  ..$ properties.Professional_scientific___techn: int [1:34] 500 75 50 150 175 125 200 75 40 200 ...
  ..$ properties.Business_administration___suppo: int [1:34] 1500 125 250 225 200 125 125 450 15 1250 ...
  ..$ properties.Public_administration___defence: int [1:34] 250 0 40 250 0 200 0 0 0 0 ...
  ..$ properties.Education                      : int [1:34] 700 350 400 300 500 800 350 250 40 400 ...
  ..$ properties.Health                         : int [1:34] 450 700 1000 12000 450 1500 350 500 75 125 ...
  ..$ properties.Arts_entertainment_recreation__: int [1:34] 250 175 200 300 350 100 50 75 10 75 ...
  ..$ properties.Shape__Area                    : num [1:34] 55226760 10024921 7056717 5886048 11020282 ...
  ..$ properties.Shape__Length                  : num [1:34] 39581 20425 15018 10857 19802 ...</code></pre>
</div>
</div>
<p>Well, it‚Äôs complicated. Looking on the above output of <code>list()</code> the object that looks most useful to us is the <code>dat$features</code>.</p>
<div class="cell" type="alert alert-warning">
<div class="alert alert-warning">
<p>
<strong>Question</strong>: Based on the output of <code>list()</code>, why do you think is <code>dat$features</code> the most useful part of <code>dat</code> for us?
</p>
</div>
</div>
<p>And if you want to see how the dataframe <code>dat$features</code> looks like, the below function will show the first five rows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(dat<span class="sc">$</span>features)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 34
Columns: 28
$ type                                       &lt;chr&gt; "Feature", "Feature", "Feat‚Ä¶
$ id                                         &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, ‚Ä¶
$ geometry.type                              &lt;chr&gt; "Polygon", "Polygon", "Poly‚Ä¶
$ geometry.coordinates                       &lt;list&gt; &lt;&lt;array[1 x 7825 x 2]&gt;&gt;, &lt;‚Ä¶
$ properties.OBJECTID                        &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, ‚Ä¶
$ properties.Ward_code_1                     &lt;chr&gt; "E05010886", "E05010901", "‚Ä¶
$ properties.Ward                            &lt;chr&gt; "Avonmouth and Lawrence Wes‚Ä¶
$ properties.Period                          &lt;int&gt; 2020, 2020, 2020, 2020, 202‚Ä¶
$ properties.Agriculture_forestry_fishing    &lt;int&gt; 10, 0, 0, 0, 0, 0, 0, 0, 0,‚Ä¶
$ properties.Mining_quarrying_utilities      &lt;int&gt; 700, 0, 0, 0, 150, 0, 0, 0,‚Ä¶
$ properties.Manufacturing                   &lt;int&gt; 1500, 50, 10, 100, 35, 50, ‚Ä¶
$ properties.Construction                    &lt;int&gt; 1500, 45, 50, 50, 50, 125, ‚Ä¶
$ properties.Motor_trades                    &lt;int&gt; 1000, 15, 25, 10, 50, 40, 3‚Ä¶
$ properties.Wholesale                       &lt;int&gt; 4000, 100, 10, 10, 100, 20,‚Ä¶
$ properties.Retail                          &lt;int&gt; 1000, 150, 150, 125, 1000, ‚Ä¶
$ properties.Transport_storage__inc_postal_  &lt;int&gt; 5000, 75, 35, 20, 50, 300, ‚Ä¶
$ properties.Accommodation_food_services     &lt;int&gt; 250, 100, 50, 150, 100, 300‚Ä¶
$ properties.Information_communication       &lt;int&gt; 175, 50, 100, 150, 125, 50,‚Ä¶
$ properties.Financial_and_insurance         &lt;int&gt; 15, 0, 10, 0, 0, 35, 10, 0,‚Ä¶
$ properties.Property                        &lt;int&gt; 125, 15, 10, 50, 100, 30, 4‚Ä¶
$ properties.Professional_scientific___techn &lt;int&gt; 500, 75, 50, 150, 175, 125,‚Ä¶
$ properties.Business_administration___suppo &lt;int&gt; 1500, 125, 250, 225, 200, 1‚Ä¶
$ properties.Public_administration___defence &lt;int&gt; 250, 0, 40, 250, 0, 200, 0,‚Ä¶
$ properties.Education                       &lt;int&gt; 700, 350, 400, 300, 500, 80‚Ä¶
$ properties.Health                          &lt;int&gt; 450, 700, 1000, 12000, 450,‚Ä¶
$ properties.Arts_entertainment_recreation__ &lt;int&gt; 250, 175, 200, 300, 350, 10‚Ä¶
$ properties.Shape__Area                     &lt;dbl&gt; 55226760, 10024921, 7056717‚Ä¶
$ properties.Shape__Length                   &lt;dbl&gt; 39581.107, 20424.954, 15018‚Ä¶</code></pre>
</div>
</div>
<p>Looking into the above, I can think of the the following necessary data cleaning and wrangling steps:</p>
<ol type="1">
<li><p>remove the first five columns as they don‚Äôt include any useful data</p></li>
<li><p>remove the string ‚Äúproperties.‚Äù from the column names</p></li>
<li><p>although not necessary, it is common practice for the first columns to contain identification data such as the ward names and codes.</p></li>
</ol>
<p>To do all the above, we will use the below functions from the <code>dplyr</code> package, which is part of the <a href="https://www.tidyverse.org/"><code>tidyverse</code> ecosystem</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat<span class="sc">$</span>features <span class="sc">%&gt;%</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>type, <span class="sc">-</span>id, <span class="sc">-</span>geometry.type, <span class="sc">-</span>geometry.coordinates, <span class="sc">-</span>properties.OBJECTID, <span class="sc">-</span>properties.Shape__Area, </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>properties.Shape__Length) <span class="sc">%&gt;%</span>                       <span class="co"># remove useless columns</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span><span class="fu">sub</span>(<span class="st">"properties."</span>, <span class="st">""</span>, .)) <span class="sc">%&gt;%</span>                 <span class="co"># ~ introduces a formula: function `sub` substitutes (in other words replaces) the string "properties." with an empty sting "" for all columns (symbol .) </span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(Ward, Ward_code_1) <span class="sc">%&gt;%</span>                             <span class="co"># looks better</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Ward_code =</span> Ward_code_1) <span class="sc">%&gt;%</span>                         <span class="co"># as above, Ward_code looks better than Ward_code_1</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()                                                   <span class="co"># a glimpse of the output</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 34
Columns: 21
$ Ward                            &lt;chr&gt; "Avonmouth and Lawrence Weston", "Henb‚Ä¶
$ Ward_code                       &lt;chr&gt; "E05010886", "E05010901", "E05010913",‚Ä¶
$ Period                          &lt;int&gt; 2020, 2020, 2020, 2020, 2020, 2020, 20‚Ä¶
$ Agriculture_forestry_fishing    &lt;int&gt; 10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0‚Ä¶
$ Mining_quarrying_utilities      &lt;int&gt; 700, 0, 0, 0, 150, 0, 0, 0, 0, 0, 30, ‚Ä¶
$ Manufacturing                   &lt;int&gt; 1500, 50, 10, 100, 35, 50, 600, 40, 35‚Ä¶
$ Construction                    &lt;int&gt; 1500, 45, 50, 50, 50, 125, 200, 125, 1‚Ä¶
$ Motor_trades                    &lt;int&gt; 1000, 15, 25, 10, 50, 40, 35, 50, 75, ‚Ä¶
$ Wholesale                       &lt;int&gt; 4000, 100, 10, 10, 100, 20, 250, 50, 0‚Ä¶
$ Retail                          &lt;int&gt; 1000, 150, 150, 125, 1000, 500, 75, 12‚Ä¶
$ Transport_storage__inc_postal_  &lt;int&gt; 5000, 75, 35, 20, 50, 300, 45, 20, 25,‚Ä¶
$ Accommodation_food_services     &lt;int&gt; 250, 100, 50, 150, 100, 300, 75, 100, ‚Ä¶
$ Information_communication       &lt;int&gt; 175, 50, 100, 150, 125, 50, 150, 100, ‚Ä¶
$ Financial_and_insurance         &lt;int&gt; 15, 0, 10, 0, 0, 35, 10, 0, 0, 10, 15,‚Ä¶
$ Property                        &lt;int&gt; 125, 15, 10, 50, 100, 30, 40, 15, 10, ‚Ä¶
$ Professional_scientific___techn &lt;int&gt; 500, 75, 50, 150, 175, 125, 200, 75, 4‚Ä¶
$ Business_administration___suppo &lt;int&gt; 1500, 125, 250, 225, 200, 125, 125, 45‚Ä¶
$ Public_administration___defence &lt;int&gt; 250, 0, 40, 250, 0, 200, 0, 0, 0, 0, 4‚Ä¶
$ Education                       &lt;int&gt; 700, 350, 400, 300, 500, 800, 350, 250‚Ä¶
$ Health                          &lt;int&gt; 450, 700, 1000, 12000, 450, 1500, 350,‚Ä¶
$ Arts_entertainment_recreation__ &lt;int&gt; 250, 175, 200, 300, 350, 100, 50, 75, ‚Ä¶</code></pre>
</div>
</div>
<p>Let‚Äôs try now to do some analysis based on these data and create some outputs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">total =</span> <span class="fu">rowSums</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">21</span>))),           <span class="co"># total jobs in a ward</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>               <span class="fu">across</span>(<span class="fu">c</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">21</span>),                             <span class="co"># select the columns you are interested in</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">.names =</span> <span class="st">"{col}_share"</span>) <span class="sc">/</span> total) <span class="sc">%&gt;%</span> <span class="co"># divide these columns by total to create industry share within ward  </span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                                                           <span class="co"># and name the new columns as oldname_share</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">23</span><span class="sc">:</span><span class="dv">40</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">!</span><span class="fu">c</span>(Ward, Ward_code),                        <span class="co"># These are the columns I am 'pivoting'</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"industry"</span>,                      <span class="co"># This is how I will name the column with all the industries ...</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"jobs_share"</span>) <span class="sc">%&gt;%</span>               <span class="co"># ... and the column with the jobs percentage</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>                                                           <span class="co"># Look https://tidyr.tidyverse.org/articles/pivot.html to </span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>                                                           <span class="co"># understand the long to wide / wide to long transformations.</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Ward <span class="sc">==</span> <span class="st">"Central"</span>) <span class="sc">%&gt;%</span>                            <span class="co"># Let's focus on Central Bristol</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>industry, <span class="at">y=</span>jobs_share)) <span class="sc">+</span>                  <span class="co"># ... and create a bar chart for it jobs distribution</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co"># to understand the "identity part go on the Details section of the geom_bar documentation:</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.rdocumentation.org/packages/ggplot2/versions/1.0.1/topics/geom_bar</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">90</span>)) <span class="sc">+</span>     <span class="co"># This line rotates the x labels,</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"jobs %"</span>)                                         <span class="co"># and here we rename the y axis. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="apis_files/figure-html/analysis-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now, let‚Äôs do something slightly more interesting. Let‚Äôs create two plots to compare the job distribution between two Bristol wards.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">total =</span> <span class="fu">rowSums</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">21</span>))),           <span class="co"># total jobs in a ward</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>               <span class="fu">across</span>(<span class="fu">c</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">21</span>),                             <span class="co"># select the columns you are interested in</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">.names =</span> <span class="st">"{col}_share"</span>) <span class="sc">/</span> total) <span class="sc">%&gt;%</span> <span class="co"># divide these columns by total to create industry share within ward  </span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                                                           <span class="co"># and name the new columns as oldname_share</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">23</span><span class="sc">:</span><span class="dv">40</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">!</span><span class="fu">c</span>(Ward, Ward_code),                        <span class="co"># These are the columns I am 'pivoting'</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"industry"</span>,                      <span class="co"># This is how I will name the column with all the industries ...</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"jobs_share"</span>) <span class="sc">%&gt;%</span>               <span class="co"># ... and the column with the jobs percentage</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>                                                           <span class="co"># Look https://tidyr.tidyverse.org/articles/pivot.html to </span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>                                                           <span class="co"># understand the long to wide / wide to long transformations.</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Ward <span class="sc">==</span> <span class="st">"Central"</span> <span class="sc">|</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>         Ward <span class="sc">==</span> <span class="st">"Easton"</span>) <span class="sc">%&gt;%</span>                             <span class="co"># Let's focus on Easton and Central Bristol</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>industry, <span class="at">y=</span>jobs_share)) <span class="sc">+</span>                  <span class="co"># ... and create a bar chart for it jobs distribution</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">90</span>)) <span class="sc">+</span>     <span class="co"># This line rotates the x labels,</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"jobs %"</span>) <span class="sc">+</span>                                       <span class="co"># and here we rename the y axis. </span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Ward), <span class="at">ncol =</span> <span class="dv">2</span>)                       <span class="co"># facet_wrap creates two graphs based on `ward` and puts one next to each other</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="apis_files/figure-html/comparison-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Well done! You‚Äôve just utilised Bristol‚Äôs open data and became part of the urban open data revolution üòÉ.</p>
<p>Obviously the <code>x</code> labels are rather ugly.</p>
<div class="cell" type="alert alert-warning">
<div class="alert alert-warning">
<p>
<strong>Task:</strong> using and tweaking the code provided here, can you rename these labels?
</p>
</div>
</div>
<div class="cell" type="alert alert-warning">
<div class="alert alert-warning">
<p>
<strong>Next task:</strong> Search for some other interesting data from <a href="https://opendata.bristol.gov.uk/">opendata.bristol.gov.uk</a>, access it programmatically, do the necessary data wrangling and produce some graphs in a new <code>.Rmd</code> document. Make sure to knit it as <code>.html</code>.
</p>
<p>
If this is to easy for you, why don‚Äôt you check the new <a href="https://quarto.org/docs/guide/">Quarto format</a>.
</p>
</div>
</div>
</section>
<section id="accessing-apis-using-existing-r-packages" class="level2">
<h2 class="anchored" data-anchor-id="accessing-apis-using-existing-r-packages">Accessing APIs using existing <code>R</code> packages</h2>
<p>Now you might be lucky and somebody else has already done all the infrastructural / back-end work in order for you to easily interrogate an API and access their data. How would this look like? Like another <code>R</code> package. Here is a list with a few examples:</p>
<ul>
<li><p><code>nomisr</code> is a package that allows you to access <a href="https://www.nomisweb.co.uk/">Nomis</a> data with <code>R</code>. Find <a href="https://cran.r-project.org/web/packages/nomisr/vignettes/introduction.html">here</a> an introduction.</p></li>
<li><p><code>tidysencus</code> is part of the <code>tidyverse</code> ecosystem and offers access to the US Census. This is the <a href="https://walker-data.com/tidycensus/">link</a>. Pay extra attention to the <em>spatial data</em> option.</p></li>
<li><p>The city of Toronto offers an <code>R</code> <a href="https://sharlagelfand.github.io/opendatatoronto/">package</a> to access <a href="https://open.toronto.ca/">City of Toronto Open Data Portal</a>.</p></li>
<li><p>See a relevant book by <span class="citation" data-cites="apis">Bauer, Landesvatter, and Behrens (<a href="#ref-apis" role="doc-biblioref">2022</a>)</span> available <a href="https://bookdown.org/paul/apis_for_social_scientists/">here</a>.</p></li>
</ul>
<div class="cell" type="alert alert-warning">
<div class="alert alert-warning">
<p>
<strong>Another task:</strong> On your own time, play with these packages and access some of the (urban) data they offer.
</p>
</div>
</div>
</section>
<section id="references" class="level2">




</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-amazonWhatAPI" class="csl-entry" role="listitem">
AWS, Amazon. 2022. <span>‚Äú<span>W</span>hat Is an <span>A</span><span>P</span><span>I</span>? - <span>A</span><span>P</span><span>I</span> <span>B</span>eginner‚Äôs <span>G</span>uide - <span>A</span><span>W</span><span>S</span> ‚Äî Aws.amazon.com.‚Äù</span> <a href="https://aws.amazon.com/what-is/api/#:~:text=API%20stands%20for%20Application%20Programming,other%20using%20requests%20and%20responses." class="uri">https://aws.amazon.com/what-is/api/#:~:text=API%20stands%20for%20Application%20Programming,other%20using%20requests%20and%20responses.</a>
</div>
<div id="ref-apis" class="csl-entry" role="listitem">
Bauer, P. C., Landesvatter C., and L. Behrens. 2022. <span>‚ÄúAPIs for Social Scientists: A Collaborative Review V1.0.‚Äù</span> https://doi.org/<a href="https://doi.org/10.5281/zenodo.6798690">https://doi.org/10.5281/zenodo.6798690</a>.
</div>
<div id="ref-jsonJSON" class="csl-entry" role="listitem">
JSON. <span>‚Äú<span>J</span><span>S</span><span>O</span><span>N</span> ‚Äî Json.org.‚Äù</span> <a href="https://www.json.org/json-en.html" class="uri">https://www.json.org/json-en.html</a>.
</div>
<div id="ref-singleton2017urban" class="csl-entry" role="listitem">
Singleton, Alex D, Seth Spielman, and David Folch. 2017. <em>Urban Analytics</em>. Sage.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Every column is a variable; every row is an observation; every cell is a single value. See [here])(https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html) for more info<a href="#fnref1" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>